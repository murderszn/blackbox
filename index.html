<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Box - Lifestyle Affordability Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700;800&family=Rajdhani:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --bg-secondary: #0d0d0d;
            --bg-tertiary: #080808;
            --card: #050505; /* deeper matte base */
            --card-hover: #0a0a0a; /* subtle glossy lift */
            --card-active: #0d0d0d;
            --text: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.75);
            --text-tertiary: rgba(255, 255, 255, 0.55);
            --text-muted: rgba(255, 255, 255, 0.35);
            --border: rgba(255, 255, 255, 0.06);
            --border-light: rgba(255, 255, 255, 0.1);
            --border-focus: rgba(255, 255, 255, 0.2);
            --accent: #ffffff;
            --accent-hover: rgba(255, 255, 255, 0.85);
            --shadow-sm: rgba(0, 0, 0, 0.95);
            --shadow-md: rgba(0, 0, 0, 0.85);
            --shadow-lg: rgba(0, 0, 0, 0.75);
            --gloss-sheen: rgba(255, 255, 255, 0.12);
            --gloss-sheen-hover: rgba(255, 255, 255, 0.2);
            --matte-overlay: rgba(255, 255, 255, 0.015);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-16px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes pulseGlow {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        @keyframes expandLine {
            to { transform: scaleX(1); }
        }

        /* Scroll-triggered animation classes */
        .scroll-fade-in {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .scroll-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .scroll-scale-in {
            opacity: 0;
            transform: scale(0.96) translateY(30px);
            transition: opacity 0.9s cubic-bezier(0.16, 1, 0.3, 1), transform 0.9s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .scroll-scale-in.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        html {
            scroll-behavior: smooth;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            letter-spacing: -0.015em;
        }

        /* Grid background system */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: none;
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 48px 24px;
            animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .header {
            margin: 0 auto 64px auto;
            animation: slideIn 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            padding: 0;
            background: var(--bg);
            border-radius: 0;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.9),
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                inset 0 0 0 1px rgba(255, 255, 255, 0.02);
            min-height: 400px;
            aspect-ratio: 16 / 9;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-banner-media {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: 0;
            z-index: 0;
        }

        .header-banner-image {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 110%;
            min-height: 110%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%) scale(1.1);
            object-fit: cover;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            filter: brightness(1.0) contrast(1.0);
            z-index: 0;
            animation: bannerZoom 20s ease-in-out infinite alternate;
        }

        .header-banner-image.loaded {
            opacity: 0.95;
        }

        @keyframes bannerZoom {
            0% {
                transform: translate(-50%, -50%) scale(1.05);
            }
            100% {
                transform: translate(-48%, -52%) scale(1.15);
            }
        }

        @keyframes bannerMove {
            0% {
                transform: translate(-50%, -50%) scale(1.05);
            }
            25% {
                transform: translate(-48%, -52%) scale(1.08);
            }
            50% {
                transform: translate(-52%, -48%) scale(1.1);
            }
            75% {
                transform: translate(-50%, -50%) scale(1.08);
            }
            100% {
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        .header-banner-title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 200;
            text-align: center;
            pointer-events: none;
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            mix-blend-mode: normal !important;
            isolation: isolate;
            padding: 0 32px;
        }

        @keyframes titleFloat {
            0%, 100% {
                transform: translate(-50%, -50%);
            }
            50% {
                transform: translate(-50%, -52%);
            }
        }

        .header-banner-title-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            width: 100%;
            position: relative;
        }

        .header-banner-title-text {
            font-family: 'Exo 2', sans-serif;
            font-size: clamp(4rem, 12vw, 10rem);
            font-weight: 900;
            letter-spacing: 0.08em;
            color: #ffffff !important;
            text-transform: uppercase;
            margin: 0;
            line-height: 0.95;
            text-shadow:
                0 0 20px rgba(255, 255, 255, 0.3),
                0 0 40px rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.5) !important;
            opacity: 1;
            text-align: center;
            filter: none !important;
            -webkit-text-fill-color: #ffffff !important;
            background: none !important;
            -webkit-background-clip: unset !important;
            background-clip: unset !important;
            mix-blend-mode: normal !important;
            transform: scale(1);
            transition: transform 0.3s ease;
            z-index: 200;
            position: relative;
        }

        .header-banner-title-text:hover {
            transform: scale(1.02);
        }

        .beta-tag {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            font-weight: 700;
            letter-spacing: 0.2em;
            color: #ffffff !important;
            text-transform: uppercase;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.6);
            padding: 8px 16px;
            border-radius: 0;
            opacity: 0;
            animation: fadeInTitle 1.4s ease-out 0.5s forwards;
            mix-blend-mode: normal !important;
            white-space: nowrap;
            position: relative;
            margin-bottom: 16px;
            align-self: flex-start;
            box-shadow: 
                0 0 12px rgba(255, 255, 255, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.2);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        @keyframes fadeInTitle {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .header-banner-countdown {
            margin-top: 24px;
            margin-bottom: 12px;
            opacity: 0;
            animation: fadeInCountdown 1.6s ease-out 1.0s forwards;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .countdown-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            line-height: 1;
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(255, 255, 255, 0.5);
        }

        .countdown-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-top: 4px;
            line-height: 1;
        }

        @keyframes fadeInCountdown {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-banner-subtitle {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.35em;
            color: #ffffff !important;
            text-transform: uppercase;
            margin-top: 24px;
            opacity: 0;
            animation: fadeInSubtitle 1.4s ease-out 1.2s forwards;
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.1),
                0 1px 2px rgba(0, 0, 0, 0.2) !important;
            filter: none !important;
            -webkit-text-fill-color: #ffffff !important;
            background: none !important;
            mix-blend-mode: normal !important;
            position: relative;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 28px;
            flex-wrap: wrap;
            width: 100%;
        }

        .subtitle-main {
            position: relative;
            flex: 0 1 auto;
            text-align: center;
        }

        .subtitle-accent {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 400;
            letter-spacing: 0.2em;
            color: rgba(255, 255, 255, 0.6) !important;
            text-transform: uppercase;
            position: relative;
            padding: 0 0;
            flex: 0 0 auto;
        }

        .subtitle-divider {
            width: 1px;
            height: 24px;
            background: rgba(255, 255, 255, 0.35);
            flex: 0 0 auto;
        }

        @keyframes fadeInSubtitle {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-email-signup {
            margin-top: 48px;
            width: 100%;
            max-width: 520px;
            opacity: 0;
            animation: fadeInSignup 1.2s ease-out 1s forwards;
            pointer-events: auto;
            position: relative;
            padding-top: 32px;
        }

        .header-email-signup::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 1px;
            background: var(--border-light);
        }

        @keyframes fadeInSignup {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .email-signup-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
            width: 100%;
        }

        .email-signup-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 400;
            color: var(--text-secondary) !important;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 4px;
            line-height: 1.5;
        }

        .email-signup-input-group {
            display: flex;
            gap: 8px;
            width: 100%;
            align-items: stretch;
        }

        .email-signup-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            width: 100%;
            align-items: stretch;
        }

        .email-signup-input-group:first-of-type {
            margin-bottom: 0;
        }

        .email-signup-input {
            flex: 1;
            padding: 14px 18px;
            background: var(--card);
            border: 1px solid var(--border-light);
            border-radius: 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            font-weight: 400;
            color: var(--text);
            letter-spacing: 0.05em;
            text-align: center;
            transition: all 0.25s ease;
            min-width: 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .email-signup-input::placeholder {
            color: var(--text-tertiary);
            letter-spacing: 0.05em;
            text-align: center;
        }

        .email-signup-input:focus {
            outline: none;
            background: var(--card);
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.08), inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .btn,
        .email-signup-button {
            background: var(--card);
            background-image: none;
            border: 1px solid var(--border-light);
            border-radius: 0;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            text-transform: uppercase;
            position: relative;
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.03),
                0 2px 8px var(--shadow-sm);
        }

        .email-signup-button {
            padding: 14px 32px;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            transition: all 0.25s ease;
            white-space: nowrap;
            min-height: 48px;
        }

        .email-signup-button:active {
            transform: translateY(0);
        }

        .email-signup-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .email-signup-success {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8) !important;
            letter-spacing: 0.05em;
            text-align: center;
            margin-top: 8px;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .email-signup-success.show {
            opacity: 1;
            transform: translateY(0);
        }

        .header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 1;
            pointer-events: none;
            animation: overlayPulse 8s ease-in-out infinite;
        }

        @keyframes overlayPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.95;
            }
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 0;
            background: none;
            animation: none;
            z-index: 2;
        }

        .header::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.02) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.015) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.01) 0%, transparent 60%);
            pointer-events: none;
            animation: pulseGlow 10s ease-in-out infinite;
            z-index: 1;
        }


        .header-content {
            position: relative;
            z-index: 3;
            width: 100%;
            max-width: 900px;
        }

        .header h1 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 4.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--text);
            letter-spacing: 0.05em;
            line-height: 1;
            text-transform: uppercase;
            background: linear-gradient(180deg, 
                #ffffff 0%, 
                rgba(255, 255, 255, 0.98) 25%,
                rgba(255, 255, 255, 0.95) 50%,
                rgba(255, 255, 255, 0.92) 75%,
                rgba(255, 255, 255, 0.9) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            display: inline-block;
            filter: drop-shadow(0 0 40px rgba(255, 255, 255, 0.2)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.7)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.9));
            text-shadow: 0 2px 30px rgba(0, 0, 0, 0.95), 0 1px 10px rgba(0, 0, 0, 0.8);
        }

        .header h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 100%);
            transform: scaleX(0);
            animation: expandLine 1.2s ease-out 0.8s forwards;
        }

        .header p {
            font-size: 1.375rem;
            color: rgba(255, 255, 255, 0.92);
            font-weight: 300;
            line-height: 1.7;
            max-width: 750px;
            margin-top: 32px;
            letter-spacing: -0.01em;
            position: relative;
            padding-left: 24px;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.9), 0 1px 8px rgba(0, 0, 0, 0.8), 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .header p::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0.4) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                transparent 100%);
        }


        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: clamp(24px, 3vw, 40px);
            margin-bottom: 40px;
        }

        .panel,
        .chart-container,
        .instructions-panel,
        .summary-card {
            border: 1px solid var(--border);
            border-radius: 0;
            position: relative;
            overflow: hidden;
        }

        .panel,
        .chart-container {
            background: var(--card);
            background-image: none;
        }

        .u-mb-24 { margin-bottom: 24px; }
        .u-mb-40 { margin-bottom: 40px; }
        .u-mt-24 { margin-top: 24px; }
        .u-w-100 { width: 100%; }
        .u-hidden { display: none !important; }
        .u-flex-gap-12 { display: flex; align-items: center; gap: 12px; }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            .mixing-board-container {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            .chart-container {
                margin-bottom: 36px;
            }
        }

        .panel {
            padding: 32px;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.03),
                0 4px 20px var(--shadow-md),
                inset 0 1px 2px rgba(255, 255, 255, 0.01);
        }

        .panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: none;
            pointer-events: none;
            opacity: 0;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.06) 50%,
                transparent 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .panel.visible::before {
            opacity: 1;
            animation: shimmer 3s ease-in-out infinite;
        }

        .panel::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 70%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.6s ease;
        }

        .panel.visible::after {
            opacity: 1;
        }

        .panel:hover {
            background: var(--card-hover);
            border-color: var(--border-light);
            transform: translateY(-2px);
            box-shadow: 
                0 12px 40px var(--shadow-md), 
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                inset 0 0 0 1px rgba(255, 255, 255, 0.06);
        }

        .panel:hover::before {
            opacity: 1;
        }

        .panel-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.375rem;
            font-weight: 600;
            margin-bottom: 32px;
            color: var(--text);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 12px;
        }

        .panel-title-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: none;
            letter-spacing: normal;
            color: var(--text-secondary);
        }

        .panel-title-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--text);
            cursor: pointer;
        }

        .panel.disabled {
            opacity: 0.5;
            border-color: var(--border);
            background: var(--bg-tertiary);
        }

        .panel.disabled .panel-title {
            color: var(--text-secondary);
        }

        .panel.disabled .form-input,
        .panel.disabled .form-label,
        .panel.disabled select {
            opacity: 0.4;
            pointer-events: none;
            cursor: not-allowed;
        }

        .panel.disabled .panel-title-checkbox {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .panel.disabled .panel-title-checkbox input[type="checkbox"] {
            cursor: not-allowed;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: none; /* Horizontal fader is the primary control */
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 400;
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
            -webkit-appearance: none;
            appearance: none;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--border-focus);
            background: var(--card);
            box-shadow: 
                0 0 0 3px rgba(255, 255, 255, 0.08),
                inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .form-input::placeholder {
            color: var(--text-tertiary);
        }

        select.form-input {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2398999d' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
            cursor: pointer;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .affordability-banner {
            background: var(--card);
            color: var(--text);
            padding: 40px 48px;
            margin-bottom: 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 0;
            position: relative;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: 
                0 12px 40px var(--shadow-md), 
                inset 0 1px 0 rgba(255, 255, 255, 0.06),
                inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        }

        .affordability-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 0;
            background: none;
            animation: none;
        }

        .affordability-banner::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
            pointer-events: none;
            opacity: 1;
            animation: pulseGlow 10s ease-in-out infinite;
        }

        .affordability-content {
            position: relative;
            z-index: 1;
        }

        .affordability-banner.negative::before {
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.15) 50%,
                transparent 100%);
        }

        .affordability-content {
            display: flex;
            align-items: center;
            gap: 28px;
            flex: 1;
        }

        .affordability-text h2 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text);
            letter-spacing: 0.05em;
            line-height: 1.2;
            text-transform: uppercase;
        }

        .affordability-text p {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.4;
            font-weight: 400;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .affordability-amount {
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(1.5rem, 3vw, 2.5rem);
            font-weight: 700;
            color: var(--text);
            letter-spacing: 0.05em;
            text-align: right;
            min-width: 180px;
            font-variant-numeric: tabular-nums;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 40px;
            justify-items: stretch;
        }

        .summary-card {
            background: var(--card);
            background-image:
                linear-gradient(180deg, var(--gloss-sheen) 0%, rgba(255, 255, 255, 0.02) 60%, transparent 100%);
            padding: 36px 28px;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            text-align: center;
            width: 100%;
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.04),
                0 6px 24px var(--shadow-md),
                inset 0 2px 4px rgba(255, 255, 255, 0.01);
        }

        .summary-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: none;
            pointer-events: none;
            opacity: 0;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.08) 50%,
                transparent 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .summary-card.visible::before {
            opacity: 1;
        }

        .summary-card:nth-child(1) { animation-delay: 0.1s; animation-fill-mode: both; }
        .summary-card:nth-child(2) { animation-delay: 0.15s; animation-fill-mode: both; }
        .summary-card:nth-child(3) { animation-delay: 0.2s; animation-fill-mode: both; }
        .summary-card:nth-child(4) { animation-delay: 0.25s; animation-fill-mode: both; }

        .summary-card:hover {
            background: var(--card-hover);
            border-color: var(--border-light);
            transform: translateY(-3px);
            box-shadow: 
                0 12px 40px var(--shadow-md), 
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                inset 0 0 0 1px rgba(255, 255, 255, 0.06);
        }

        .summary-card:hover::before {
            opacity: 1;
            animation: shimmer 2s ease-in-out infinite;
        }

        .summary-card-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 0.08em;
            margin-bottom: 16px;
            text-transform: uppercase;
        }

        .summary-card-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(1.5rem, 2.5vw, 2.25rem);
            font-weight: 700;
            color: var(--text);
            letter-spacing: 0.05em;
            line-height: 1.2;
            font-variant-numeric: tabular-nums;
        }

        .summary-card-value.positive {
            color: var(--text);
        }

        .summary-card-value.negative {
            color: var(--text);
            opacity: 0.7;
        }

        .mixing-board-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 16px;
            background: var(--bg);
            border-radius: 0;
            position: relative;
            border: 1px solid var(--border);
            box-shadow:
                inset 0 0 0 1px rgba(255, 255, 255, 0.02),
                0 4px 16px rgba(0, 0, 0, 0.8);
        }

        .mixing-board-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 24px 24px;
            pointer-events: none;
            opacity: 0.3;
        }

        .budget-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 10px;
            background: var(--bg);
            border-radius: 0;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            height: 240px;
            position: relative;
            width: 100%;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow:
                inset 0 0 0 1px rgba(255, 255, 255, 0.02),
                0 2px 8px rgba(0, 0, 0, 0.6);
        }

        .budget-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.06) 50%,
                transparent 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .budget-item.visible::before {
            opacity: 1;
        }

        .budget-item:hover {
            background: var(--bg-secondary);
            border-color: var(--border-light);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.02);
        }

        .budget-item:hover::before {
            opacity: 1;
            animation: shimmer 2.5s ease-in-out infinite;
        }

        .budget-item-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-align: center;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            font-weight: 500;
        }

        .budget-item-input {
            width: 100%;
            text-align: center;
            font-size: 0.85rem;
            padding: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
        }

        .budget-toggle-btn {
            margin: 0;
            margin-bottom: 8px;
            width: auto;
            min-width: 32px;
            z-index: 10;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .budget-toggle-btn.enabled {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            color: rgba(255, 255, 255, 0.9);
        }

        .budget-toggle-btn.enabled:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .budget-toggle-btn.disabled {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.5);
        }

        .budget-toggle-btn.disabled:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .budget-item.disabled {
            opacity: 0.6;
        }

        /* Budget card layout */
        .budget-item-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            height: 100%;
            width: 100%;
            text-align: center;
            padding: 8px 0;
        }

        .budget-item-top {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .budget-item-name {
            text-align: center;
        }

        .budget-item-toggle-row {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding-top: 8px;
        }

        .budget-item-amount-row {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .budget-item-amount-row .budget-amount-display,
        .budget-item-amount-row .income-amount-display {
            font-size: 1.5rem;
            font-weight: 700;
            padding: 10px 14px;
        }

        .budget-item-slider-row {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 4px;
            width: 100%;
        }

        @media (max-width: 480px) {
            .budget-item-amount-row .budget-amount-display,
            .budget-item-amount-row .income-amount-display {
                font-size: 1.3rem;
                padding: 8px 12px;
            }
        }

        /* Sliding toggle switch - monochrome black/white */
        .toggle-switch {
            width: 44px;
            height: 24px;
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            background: #0b0b0b; /* off: black */
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.6), 0 0 0 0 rgba(255,255,255,0);
            flex-shrink: 0;
        }

        .toggle-switch:hover {
            border-color: rgba(255, 255, 255, 0.28);
        }

        .toggle-switch:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.18);
        }

        .toggle-switch.enabled {
            background: #ffffff; /* on: white */
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.08), 0 0 0 0 rgba(255,255,255,0);
        }

        .toggle-thumb {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ffffff; /* off thumb: white on black track */
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 1px 2px rgba(0,0,0,0.55);
            transition: left 0.2s ease, transform 0.18s ease;
        }

        .toggle-switch:hover .toggle-thumb { transform: translateY(-0.5px); }

        .toggle-switch.enabled .toggle-thumb {
            left: 23px;
            background: #0b0b0b; /* on thumb: black on white track */
            border-color: rgba(0, 0, 0, 0.7);
            box-shadow: 0 1px 2px rgba(0,0,0,0.45);
        }

        @media (max-width: 480px) {
            .toggle-switch { width: 40px; height: 22px; }
            .toggle-thumb { width: 16px; height: 16px; top: 3px; left: 3px; }
            .toggle-switch.enabled .toggle-thumb { left: 21px; }
        }

        .budget-slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%;
            flex: 1;
            justify-content: center;
            position: relative;
            cursor: ew-resize;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            touch-action: none;
            margin: 8px 0;
        }

        .budget-name-input {
            font-size: 0.75rem;
            padding: 6px 8px;
            text-align: center;
            font-weight: 600;
        }

        .budget-name-input--readonly {
            cursor: default;
        }

        .budget-toggle-compact {
            font-size: 0.7rem;
            padding: 4px 8px;
        }

        .budget-slider-container.is-disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        .budget-amount-display.is-disabled {
            opacity: 0.4;
            cursor: default;
        }

        /* Consolidate budget-slider-container mobile overrides */
        @media (max-width: 768px) {
        }

        @media (max-width: 480px) {
            .budget-slider-container {
                padding: 4px 0;
            }
        }

        .fader-track {
            width: 120px;
            height: 20px;
            background: #000000;
            border: 2px solid var(--border);
            border-radius: 0;
            position: relative;
            margin: 0 auto;
            cursor: ew-resize;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
        }

        .fader-level {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0;
            transition: width 0.1s ease;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .fader-handle {
            position: absolute;
            top: -2px;
            left: -8px;
            width: 16px;
            height: calc(100% + 4px);
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--border);
            border-radius: 0;
            cursor: ew-resize;
            transition: all 0.1s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            touch-action: none;
            z-index: 10;
        }

        .fader-handle:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }

        /* Consolidated 768px media query */
        @media (max-width: 768px) {
            /* Fader handle adjustments */
            .fader-handle,
            .fader-handle.income-fader-handle {
                width: 14px;
                height: calc(100% + 6px);
                top: -3px;
                left: -7px;
                border-width: 1.5px;
            }

            /* App container and header adjustments */
            .app-container {
                padding: 24px 16px;
            }

            .header {
                padding: 0;
                margin-bottom: 32px;
                border-radius: 0;
                min-height: 420px;
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
            }

            .header-banner-title-wrapper {
                flex-wrap: wrap;
                gap: 12px;
            }

            .header-banner-title-text {
                font-size: 5.5rem;
                font-weight: 900;
                letter-spacing: 0.08em;
                opacity: 1 !important;
            }

            .beta-tag {
                font-size: 0.6875rem;
                font-weight: 700;
                padding: 6px 12px;
                margin-top: -20px;
                letter-spacing: 0.15em;
                border-width: 1.5px;
            }

            .header-banner-subtitle {
                font-size: 0.875rem;
                font-weight: 600;
                letter-spacing: 0.25em;
                gap: 12px;
                flex-direction: column;
            }

            .subtitle-accent {
                font-size: 0.6875rem;
                padding: 0 10px;
            }

            .header-banner-title {
                max-width: 100%;
                padding: 0 16px;
            }

            .header-email-signup {
                margin-top: 32px;
                max-width: 100%;
                padding: 24px 16px 0;
            }

            .header-email-signup::before {
                width: 60px;
            }

            .email-signup-input-group {
                flex-direction: column;
            }
            .email-signup-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .email-signup-button {
                width: 100%;
            }

            .email-signup-text {
                font-size: 0.6875rem;
            }

            /* AI Analysis panel */
            .ai-analysis-panel {
                margin-top: 32px;
                margin-bottom: 32px;
            }

            .ai-analysis-title {
                font-size: 1.25rem;
            }

            .ai-analysis-actions {
                flex-direction: column;
                width: 100%;
                align-items: stretch;
            }

            .ai-rerun-button {
                width: 100%;
            }

            .ai-grade-display {
                flex-direction: column;
                gap: 16px;
            }

            .ai-grade-letter {
                font-size: 3rem;
            }

            .ai-grade-meter {
                max-width: 100%;
            }

            .ai-insights {
                grid-template-columns: 1fr;
            }

            .ai-insight-item {
                padding: 16px;
            }

            /* Footer */
            .footer {
                padding: 48px 32px;
                margin-top: 64px;
                border-radius: 0;
            }

            .footer-brand {
                font-size: 1.5rem;
            }

            .footer-tagline {
                font-size: 0.6875rem;
                letter-spacing: 0.15em;
            }

            .footer-dev-tag {
                font-size: 0.625rem;
                margin-top: 24px;
            }
        }

        @media (max-width: 480px) {
            .fader-handle {
                height: 18px;
                top: -9px;
                left: -2px;
                right: -2px;
                min-height: 36px;
                border-width: 1px;
            }

            .fader-handle.income-fader-handle {
                height: 18px;
                top: -9px;
                left: -2px;
                right: -2px;
                min-height: 36px;
                border-width: 1px;
            }

            .header-banner-title-text {
                font-size: 4.5rem;
                font-weight: 900;
                letter-spacing: 0.06em;
                opacity: 1 !important;
            }

            .header {
                min-height: 300px;
            }
        }

        .budget-slider {
            width: 100%;
            max-width: 260px;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #050505 0%, #000000 100%);
            outline: none;
            transition: all 0.3s ease;
            margin: 0 auto;
            display: none; /* Horizontal fader is the primary control */
            -webkit-tap-highlight-color: transparent;
            touch-action: none;
        }

        .budget-amount-display {
            font-weight: 600;
            color: var(--text);
            font-size: 1rem;
            text-align: center;
            min-width: 80px;
            padding: 4px 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            cursor: text;
            user-select: none;
            transition: all 0.2s ease;
        }

        .budget-amount-display:hover {
            background: var(--bg-secondary);
            border-color: var(--border-light);
        }

        .budget-amount-display.editing {
            background: var(--card);
            border-color: rgba(255, 255, 255, 0.4);
        }


        .fader-track.income-fader-track {
            border-radius: 4px;
        }


        .fader-handle.income-fader-handle {
            border-radius: 3px;
        }

        .budget-item.income-item .budget-amount-display.editing {
            border-color: rgba(255, 255, 255, 0.4);
        }

        .budget-slider.income-slider {
            width: 100%;
            max-width: 260px;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #050505 0%, #000000 100%);
            outline: none;
            transition: all 0.3s ease;
            margin: 0 auto;
            display: block;
        }

        .budget-amount-display.income-amount-display {
            font-weight: 700;
            color: var(--text);
            text-align: center;
            background: var(--bg);
            border: 1px solid var(--border);
            cursor: text;
            user-select: none;
            transition: all 0.2s ease;
        }

        .budget-amount-display.income-amount-display:hover {
            background: var(--bg-secondary);
            border-color: var(--border-light);
        }

        .budget-amount-display.income-amount-display.editing {
            background: var(--card);
            border-color: rgba(255, 255, 255, 0.4);
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 24px 16px;
            }

            .header {
                padding: 0;
                margin-bottom: 32px;
                border-radius: 0;
                min-height: 420px;
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
            }

            .header-banner-title-wrapper {
                flex-wrap: wrap;
                gap: 12px;
            }

            .header-banner-title-text {
                font-size: 5.5rem;
                font-weight: 900;
                letter-spacing: 0.08em;
                opacity: 1 !important;
            }

            .beta-tag {
                font-size: 0.6875rem;
                font-weight: 700;
                padding: 6px 12px;
                margin-top: -20px;
                letter-spacing: 0.15em;
                border-width: 1.5px;
            }

            .header-banner-subtitle {
                font-size: 0.875rem;
                font-weight: 600;
                letter-spacing: 0.25em;
                gap: 12px;
                flex-direction: column;
            }

            .subtitle-accent {
                font-size: 0.6875rem;
                padding: 0 10px;
            }

            .header-banner-title {
                max-width: 100%;
                padding: 0 16px;
            }

            .header-email-signup {
                margin-top: 32px;
                max-width: 100%;
                padding: 24px 16px 0;
            }

            .header-email-signup::before {
                width: 60px;
            }

            .email-signup-input-group {
                flex-direction: column;
            }
            .email-signup-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .email-signup-button {
                width: 100%;
            }

            .email-signup-text {
                font-size: 0.6875rem;
            }

            .header h1 {
                font-size: 2.75rem;
                margin-bottom: 20px;
            }

            .header h1::after {
                bottom: -6px;
                height: 1.5px;
            }

            .header p {
                font-size: 1.125rem;
                margin-top: 24px;
                padding-left: 20px;
            }

            .header p::before {
                width: 1.5px;
            }


            .affordability-banner {
                padding: 28px 24px;
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .affordability-amount {
                min-width: auto;
                text-align: center;
            }

            .mixing-board-container {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 10px;
                padding: 12px;
            }

            .budget-item {
                height: 220px;
                padding: 6px 8px;
            }

            .budget-item-input {
                padding: 4px 6px;
                font-size: 0.7rem;
                margin-bottom: 0;
                order: 1;
                width: 100%;
            }

            .budget-toggle-btn {
                margin-bottom: 6px;
                padding: 3px 8px;
                font-size: 0.6rem;
                order: 2;
                width: auto;
                align-self: center;
            }

            .budget-amount-display {
                order: 3;
                margin-top: 0;
                margin-bottom: 8px;
                font-size: 0.85rem;
                padding: 4px 6px;
                min-width: 70px;
            }


            .budget-item-label {
                font-size: 0.7rem;
                min-height: 28px;
                text-align: center;
            }

            .fader-track,
            .fader-track.income-fader-track {
                height: 18px;
                width: 160px;
                border-width: 1.5px;
            }


            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin-bottom: 32px;
            }

            .summary-card {
                padding: 28px 20px;
                max-width: none;
            }

            .summary-card-label {
                font-size: 0.75rem;
                margin-bottom: 14px;
            }

            .summary-card-value {
                font-size: 1.875rem;
            }
        }

        @media (max-width: 480px) {
            .budget-item {
                height: 200px;
                padding: 4px 6px;
            }

            .budget-item-input {
                padding: 3px 5px;
                font-size: 0.65rem;
            }

            .budget-toggle-btn {
                margin-bottom: 4px;
                padding: 2px 6px;
                font-size: 0.55rem;
            }

            .budget-amount-display {
                font-size: 1.3rem;
                padding: 7px 10px;
                min-width: 60px;
                margin-bottom: 6px;
            }

            .budget-item-label {
                font-size: 0.65rem;
                min-height: 24px;
            }

            .budget-slider-container {
                padding: 4px 0;
                /* Redesigned sliders for mobile usability */
            }

            .budget-amount-display {
                font-size: 1.3rem;
                padding: 7px 10px;
                min-width: 60px;
            }

            .fader-track,
            .fader-track.income-fader-track {
                width: 160px;
                height: 28px;
                border-width: 2px;
                border-radius: 2px;
                background: linear-gradient(90deg, #0a0a0a 0%, #000000 100%);
                box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.9), 0 0 6px rgba(255, 255, 255, 0.1);
            }

            .fader-handle,
            .fader-handle.income-fader-handle {
                width: 20px;
                height: calc(100% + 6px);
                border-radius: 1px;
                background: rgba(255, 255, 255, 0.95);
                border: 2px solid rgba(255, 255, 255, 0.8);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
            }

            .fader-level,
            .fader-level.income-fader-level {
                background: linear-gradient(90deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
                border-radius: 1px 0 0 1px;
                box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4), 0 0 4px rgba(255, 255, 255, 0.2);
            }

            .header-banner-countdown {
                gap: 8px;
                margin-top: 16px;
                margin-bottom: 6px;
            }

            .countdown-item {
                min-width: 45px;
                padding: 5px 6px;
            }

            .countdown-number {
                font-size: 1.25rem;
            }

            .countdown-label {
                font-size: 0.45rem;
                margin-top: 2px;
            }

            .mixing-board-container {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 8px;
                padding: 10px;
            }
        }

        .budget-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .budget-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            border-color: var(--border-light);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 1);
        }

        .budget-slider::-moz-range-thumb {
            width: 32px;
            height: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .budget-slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            border-color: var(--border-light);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 1);
        }

        .budget-slider::-webkit-slider-runnable-track {
            height: 8px;
            background: linear-gradient(90deg, #050505 0%, #000000 100%);
            border: 1px solid var(--border);
            border-radius: 0;
        }

        .budget-slider::-moz-range-track {
            height: 8px;
            background: linear-gradient(90deg, #050505 0%, #000000 100%);
            border: 1px solid var(--border);
            border-radius: 0;
        }

        .budget-slider.income-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .budget-slider.income-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            border-color: var(--border-light);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 1);
        }

        .budget-slider.income-slider::-moz-range-thumb {
            width: 32px;
            height: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .budget-slider.income-slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            border-color: var(--border-light);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 1);
        }

        .budget-slider.income-slider::-webkit-slider-runnable-track {
            height: 8px;
            background: #000000;
            border: 1px solid var(--border);
            border-radius: 0;
        }

        .budget-slider.income-slider::-moz-range-track {
            height: 8px;
            background: #000000;
            border: 1px solid var(--border);
            border-radius: 0;
        }


        .btn {
            padding: 10px 20px;
            font-size: 0.75rem;
            transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
            letter-spacing: 0.08em;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            min-height: 44px;
            min-width: 44px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.15) 50%,
                transparent 100%);
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .btn:hover,
        .email-signup-button:hover {
            background: var(--card-hover);
            background-image: none;
            border-color: var(--border-focus);
            transform: translateY(-1px);
            box-shadow: 
                0 6px 20px var(--shadow-md),
                inset 0 0 0 1px rgba(255, 255, 255, 0.06),
                inset 0 1px 2px rgba(255, 255, 255, 0.02);
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 8px var(--shadow-sm),
                inset 0 1px 2px rgba(255, 255, 255, 0.01);
        }

        .btn-danger {
            background: var(--bg-secondary);
            border-color: var(--border);
            color: var(--text);
            padding: 8px 16px;
            font-size: 0.75rem;
            border-radius: 0;
            min-height: 44px;
            min-width: 44px;
        }

        .btn-danger:hover {
            background: var(--bg-secondary);
            border-color: var(--border-light);
        }

        .chart-container {
            padding: clamp(24px, 3vw, 36px);
            margin-bottom: 48px;
            box-shadow: 
                0 8px 32px var(--shadow-md), 
                inset 0 1px 0 rgba(255, 255, 255, 0.04),
                inset 0 0 0 1px rgba(255, 255, 255, 0.03);
        }

        .chart-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: none;
            pointer-events: none;
            opacity: 0;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.08) 50%,
                transparent 100%);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .chart-container.visible::before {
            opacity: 1;
            animation: shimmer 3.5s ease-in-out infinite;
        }

        .chart-container:hover {
            background: var(--card-hover);
            border-color: var(--border-light);
            box-shadow: 
                0 12px 48px var(--shadow-md), 
                inset 0 1px 0 rgba(255, 255, 255, 0.06),
                inset 0 0 0 1px rgba(255, 255, 255, 0.04);
            transform: translateY(-2px);
        }

        .chart-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.375rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
            border-bottom: 1px solid var(--border);
            padding-bottom: 12px;
        }

        .chart-description {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 400;
            color: var(--text-secondary);
            letter-spacing: 0.02em;
            line-height: 1.6;
            margin-bottom: 24px;
            position: relative;
            z-index: 1;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg);
            border: 1px solid var(--border);
        }

        thead {
            background: linear-gradient(180deg, #0a0a0a 0%, #000000 100%);
            border-bottom: 1px solid var(--border);
        }

        th {
            padding: 16px;
            text-align: left;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            color: var(--text);
            font-size: 0.875rem;
        }

        tr:hover {
            background: linear-gradient(90deg, #0a0a0a 0%, #050505 100%);
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            background: var(--bg-secondary);
            color: var(--text);
            border-radius: 0;
        }

        .badge-success {
            border-color: var(--border-light);
        }

        .badge-danger {
            border-color: var(--border);
            opacity: 0.6;
        }

        .section-divider {
            height: 1px;
            background: var(--border);
            margin: 30px 0;
        }

        .treemap-container {
            width: 100%;
            height: 600px;
            margin-top: 20px;
            position: relative;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 8px;
        }

        .treemap-svg {
            width: 100%;
            height: 100%;
        }

        .treemap-rect {
            stroke: var(--border);
            stroke-width: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .treemap-rect:hover {
            opacity: 0.9;
            stroke: rgba(255, 255, 255, 0.8);
            stroke-width: 2px;
            filter: brightness(1.1);
        }

        .treemap-text tspan {
            fill: var(--text);
        }

        .treemap-text {
            pointer-events: none;
            font-family: 'JetBrains Mono', monospace;
            fill: var(--text);
        }

        .treemap-label {
            font-size: 12px;
            font-weight: 600;
            dominant-baseline: hanging;
            text-anchor: start;
            letter-spacing: 0.05em;
            line-height: 1.4;
        }

        .treemap-label tspan {
            dominant-baseline: hanging;
        }

        .treemap-amount {
            font-size: 16px;
            font-weight: 700;
            dominant-baseline: hanging;
            text-anchor: start;
            letter-spacing: 0.02em;
            line-height: 1.3;
        }

        .treemap-percentage {
            font-size: 10px;
            font-weight: 500;
            opacity: 0.75;
            dominant-baseline: hanging;
            text-anchor: start;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            line-height: 1.3;
        }

        .treemap-tooltip {
            position: absolute;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 16px 20px;
            pointer-events: none;
            font-size: 0.875rem;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .treemap-tooltip.show {
            opacity: 1;
        }

        .treemap-tooltip-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .treemap-tooltip-amount {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            margin: 4px 0;
        }

        .treemap-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .treemap-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
        }

        .treemap-legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* Tooltip Styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip-trigger {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: help;
            transition: all 0.2s ease;
        }

        .tooltip-trigger:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
            border-color: var(--border-light);
            color: var(--text);
        }

        .tooltip-content {
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 0.8125rem;
            color: var(--text);
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.8);
            margin-bottom: 8px;
        }

        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--bg-secondary);
        }

        .tooltip:hover .tooltip-content {
            opacity: 1;
            pointer-events: auto;
        }

        /* Instructions Panel */
        .instructions-panel {
            background: var(--bg);
            padding: 24px;
            margin-bottom: 40px;
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.02),
                0 4px 16px rgba(0, 0, 0, 0.8);
        }

        .instructions-panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 24px 24px;
            pointer-events: none;
            opacity: 0.3;
        }

        .instructions-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.06) 50%,
                transparent 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .instructions-panel.visible::before {
            opacity: 1;
        }

        .instructions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .instructions-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .instructions-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0;
            padding: 6px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .instructions-toggle:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-light);
            color: var(--text);
        }

        .instructions-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 0;
        }

        .instructions-content.expanded {
            max-height: 1000px;
            opacity: 1;
        }

        .instruction-item {
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0;
            position: relative;
        }

        .instruction-item-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .instruction-item-title::before {
            content: '→';
            color: var(--text-secondary);
            font-weight: 400;
        }

        .instruction-item-text {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Legend/Key */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            padding: 20px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 0;
            margin-bottom: 24px;
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.02),
                0 2px 8px rgba(0, 0, 0, 0.6);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 0;
            flex-shrink: 0;
            border: 1px solid var(--border);
        }

        .legend-color.income {
            background: rgba(255, 255, 255, 0.9);
        }

        .legend-color.budget {
            background: rgba(255, 255, 255, 0.7);
        }

        /* Form Helper Text */
        .form-helper {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-top: 6px;
            line-height: 1.4;
        }

        /* AI Analysis Section */
        .ai-analysis-panel {
            margin-top: 48px;
            margin-bottom: 48px;
            opacity: 0.85;
            position: relative;
        }


        .ai-analysis-header {
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .ai-analysis-title-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .ai-analysis-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .ai-analysis-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            color: var(--text) !important;
            text-transform: uppercase;
            margin: 0;
        }

        .coming-soon-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.2em;
            color: rgba(255, 255, 255, 0.7) !important;
            text-transform: uppercase;
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 14px;
            border-radius: 0;
            white-space: nowrap;
        }

        .ai-rerun-button {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.15em;
            color: #ffffff !important;
            text-transform: uppercase;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 8px 16px;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            position: relative;
        }

        .ai-rerun-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-1px);
        }

        .ai-rerun-button:active {
            transform: translateY(0);
            background: rgba(255, 255, 255, 0.2);
        }

        .ai-rerun-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .ai-rerun-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .ai-rerun-button.disabled:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.25);
            transform: none;
        }

        .ai-rerun-button.disabled::after {
            content: ' (Sign up required)';
            font-size: 0.6em;
            opacity: 0.7;
            letter-spacing: 0.1em;
        }

        .signup-notice {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin-bottom: 24px;
            animation: fadeIn 0.4s ease-out;
        }

        .signup-notice-icon {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .signup-notice-content {
            flex: 1;
        }

        .signup-notice-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            color: #ffffff;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .signup-notice-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
        }

        .ai-rerun-loading {
            display: none;
        }

        .ai-rerun-button.loading .ai-rerun-text {
            display: none;
        }

        .ai-rerun-button.loading .ai-rerun-loading {
            display: inline-block;
        }

        .ai-analysis-preview {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .ai-grade-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 24px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 0;
        }

        .ai-grade-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.15em;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            text-align: center;
        }

        .ai-grade-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
        }

        .ai-grade-letter {
            font-family: 'Exo 2', sans-serif;
            font-size: 4rem;
            font-weight: 700;
            color: var(--text) !important;
            line-height: 1;
            min-width: 100px;
            text-align: center;
        }

        .ai-grade-meter {
            flex: 1;
            max-width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border);
            border-radius: 0;
            overflow: hidden;
            position: relative;
        }

        .ai-grade-bar {
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.6) 100%);
            transition: width 0.5s ease;
            width: 78%;
        }

        .ai-grade-score {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text) !important;
            letter-spacing: 0.05em;
            min-width: 80px;
            text-align: center;
        }

        .ai-insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .ai-insight-item {
            display: flex;
            gap: 16px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            border-radius: 0;
            transition: all 0.2s ease;
        }

        .ai-insight-item:hover {
            background: rgba(0, 0, 0, 0.3);
            border-color: var(--border-light);
        }

        .ai-insight-icon {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text) !important;
            line-height: 1;
            min-width: 24px;
            text-align: center;
        }

        .ai-insight-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }

        .ai-insight-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            color: var(--text) !important;
            text-transform: uppercase;
        }

        .ai-insight-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            font-weight: 400;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 0.02em;
        }

        .ai-analysis-footer {
            margin-top: 8px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .ai-analysis-note {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.05em;
            text-align: center;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .ai-analysis-panel {
                margin-top: 32px;
                margin-bottom: 32px;
            }

            .ai-analysis-title {
                font-size: 1.25rem;
            }

            .ai-analysis-actions {
                flex-direction: column;
                width: 100%;
                align-items: stretch;
            }

            .ai-rerun-button {
                width: 100%;
            }

            .ai-grade-display {
                flex-direction: column;
                gap: 16px;
            }

            .ai-grade-letter {
                font-size: 3rem;
            }

            .ai-grade-meter {
                max-width: 100%;
            }

            .ai-insights {
                grid-template-columns: 1fr;
            }

            .ai-insight-item {
                padding: 16px;
            }
        }

        /* Footer */
        .footer {
            margin-top: 96px;
            padding: 64px 48px;
            background: var(--bg);
            border-radius: 0;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            text-align: center;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.9), 
                inset 0 1px 0 rgba(255, 255, 255, 0.04),
                inset 0 0 0 1px rgba(255, 255, 255, 0.02);
        }

        .footer::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 24px 24px;
            pointer-events: none;
            opacity: 0.3;
            z-index: 0;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.08) 20%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.08) 80%,
                transparent 100%);
            opacity: 0;
            transition: opacity 0.6s ease;
        }

        .footer.visible::before {
            opacity: 1;
            animation: shimmer 4s ease-in-out infinite;
        }

        .footer::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.04) 0%, transparent 40%),
                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 60%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.8s ease;
            animation: pulseGlow 12s ease-in-out infinite;
        }

        .footer.visible::after {
            opacity: 1;
        }

        .footer-content {
            position: relative;
            z-index: 1;
        }

        .footer-brand {
            font-family: 'Exo 2', sans-serif;
            font-size: 2rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            color: #ffffff !important;
            text-transform: uppercase;
            margin: 0;
            line-height: 1.2;
            text-shadow: none !important;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            filter: none !important;
            -webkit-text-fill-color: #ffffff !important;
            background: none !important;
            -webkit-background-clip: unset !important;
            background-clip: unset !important;
            mix-blend-mode: normal !important;
            z-index: 1;
        }

        .footer.visible .footer-brand {
            opacity: 1;
            transform: translateY(0);
            transition-delay: 0.2s;
        }


        .footer-tagline {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 400;
            letter-spacing: 0.2em;
            color: #ffffff !important;
            text-transform: uppercase;
            margin-top: 12px;
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.4s, transform 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.4s;
            text-shadow: none !important;
            filter: none !important;
            -webkit-text-fill-color: #ffffff !important;
            background: none !important;
            mix-blend-mode: normal !important;
            position: relative;
            z-index: 1;
        }

        .footer.visible .footer-tagline {
            opacity: 1;
            transform: translateY(0);
        }

        .footer-dev-tag {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6875rem;
            font-weight: 400;
            letter-spacing: 0.05em;
            color: rgba(255, 255, 255, 0.4) !important;
            margin-top: 32px;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.6s, transform 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.6s;
            position: relative;
            z-index: 1;
        }

        .footer.visible .footer-dev-tag {
            opacity: 1;
            transform: translateY(0);
        }


        @media (max-width: 768px) {
            .footer {
                padding: 48px 32px;
                margin-top: 64px;
                border-radius: 0;
            }

            .footer-brand {
                font-size: 1.5rem;
            }

            .footer-tagline {
                font-size: 0.6875rem;
                letter-spacing: 0.15em;
            }

            .footer-dev-tag {
                font-size: 0.625rem;
                margin-top: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <!-- Banner Image -->
            <div class="header-banner-media">
                <img 
                    class="header-banner-image" 
                    id="headerBannerImage"
                    src="blackbox.png" 
                    alt="Geometric banner background"
                />
            </div>
            
            <!-- Minimal overlay for subtle depth -->
            <div class="header-overlay"></div>
            
            <!-- Banner Title -->
            <div class="header-banner-title">
                <div class="header-banner-title-wrapper">
                    <span class="beta-tag">BETA</span>
                    <h1 class="header-banner-title-text">BLACK BOX</h1>
                </div>
                <div class="header-banner-countdown" id="countdown">
                    <div class="countdown-item">
                        <div class="countdown-number" id="days">--</div>
                        <div class="countdown-label">DAYS</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="hours">--</div>
                        <div class="countdown-label">HOURS</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="minutes">--</div>
                        <div class="countdown-label">MINUTES</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="seconds">--</div>
                        <div class="countdown-label">SECONDS</div>
                    </div>
                </div>
                <div class="header-banner-subtitle">
                    <div class="subtitle-divider"></div>
                    <span class="subtitle-main">LIFESTYLE AFFORDABILITY CALCULATOR</span>
                    <div class="subtitle-divider"></div>
                </div>

                <!-- Email Signup -->
                <div class="header-email-signup">
                    <div class="email-signup-form">
                        <div class="email-signup-text">Get more tools & calculators delivered to your inbox</div>
                        <div class="email-signup-input-group email-signup-grid">
                            <input
                                class="email-signup-input" 
                                id="nameSignupInput"
                                placeholder="Your name"
                            />
                            <input 
                                type="email" 
                                class="email-signup-input" 
                                id="emailSignupInput"
                                placeholder="Enter your email"
                            />
                            <button class="email-signup-button" id="emailSignupButton">Sign Up</button>
                        </div>
                        <div class="email-signup-success" id="emailSignupSuccess"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions Panel -->
        <div class="instructions-panel">
            <div class="instructions-header">
                <div class="instructions-title">
                    <span>Quick Guide</span>
                    <div class="tooltip">
                        <div class="tooltip-trigger">?</div>
                        <div class="tooltip-content">Click to expand or collapse instructions</div>
                    </div>
                </div>
                <button class="instructions-toggle" onclick="toggleInstructions()" id="instructionsToggle" aria-expanded="false" aria-controls="instructionsContent">Show Instructions</button>
            </div>
            <div class="instructions-content" id="instructionsContent" data-auto-render="instructions"></div>
        </div>

        <div id="affordabilityBanner" class="affordability-banner">
            <div class="affordability-content">
                <div class="affordability-text">
                    <h2 id="affordabilityTitle">You Can Afford This Lifestyle</h2>
                    <p id="affordabilityDesc">Your projected savings remain positive over 5 years</p>
                </div>
            </div>
            <div class="affordability-amount" id="finalSavings">$0</div>
        </div>

        <!-- Combined Income and Budget Panel -->
        <div class="panel u-mb-40">
            <div class="panel-title u-mb-24">
                <span>Income & Monthly Spending</span>
                <div class="tooltip">
                    <div class="tooltip-trigger">?</div>
                    <div class="tooltip-content">Drag sliders or click amounts to edit values</div>
                </div>
            </div>
            <div class="legend u-mb-24">
                <div class="legend-item">
                    <div class="legend-color income"></div>
                    <span>Income (Max: $50,000/month)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color budget"></div>
                    <span>Spending (Max: $5,000/item/month)</span>
                </div>
            </div>
            <div id="budgetItems" class="mixing-board-container">
                <!-- Income and budget items will be added here -->
            </div>
            <button class="btn btn-secondary u-w-100 u-mt-24" onclick="addBudgetItem()">
                + Add Budget Item
            </button>
            <input type="number" id="monthlyIncome" class="form-input u-hidden" value="9593.42" step="0.01" oninput="updateIncomeFromInput(this.value)">
        </div>

        <div class="main-layout">
            <!-- Car Purchase Panel -->
            <div class="panel" id="carPanel">
                <div class="panel-title">
                    <span>Dream Car</span>
                    <div class="u-flex-gap-12">
                        <div class="tooltip">
                            <div class="tooltip-trigger">?</div>
                            <div class="tooltip-content">Calculate loan payments over your selected term and purchase year</div>
                        </div>
                        <div class="panel-title-checkbox">
                            <input type="checkbox" id="carEnabled" checked onchange="toggleCar()" aria-label="Include Dream Car in calculations">
                            <label for="carEnabled">Include</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Car Price</label>
                    <input type="number" id="carPrice" class="form-input" value="40000" step="100" oninput="calculate()">
                    <div class="form-helper">Total purchase price including taxes and fees</div>
                </div>
                <div class="input-group">
                    <div class="form-group">
                        <label class="form-label">Interest Rate (%)</label>
                        <input type="number" id="carInterestRate" class="form-input" value="6" step="0.1" oninput="calculate()">
                        <div class="form-helper">Annual percentage rate</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Loan Term (months)</label>
                        <input type="number" id="carLoanMonths" class="form-input" value="60" step="1" oninput="calculate()">
                        <div class="form-helper">Payment duration</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Purchase Year</label>
                    <select id="carPurchaseYear" class="form-input" data-year-options data-default="0" onchange="calculate()"></select>
                    <div class="form-helper">When you'll make the purchase</div>
                </div>
            </div>

            <!-- House Purchase Panel -->
            <div class="panel" id="housePanel">
                <div class="panel-title">
                    <span>Dream House</span>
                    <div class="u-flex-gap-12">
                        <div class="tooltip">
                            <div class="tooltip-trigger">?</div>
                            <div class="tooltip-content">Down payment uses accumulated savings. Additional monthly bills (taxes, insurance) are separate from loan payment</div>
                        </div>
                        <div class="panel-title-checkbox">
                            <input type="checkbox" id="houseEnabled" checked onchange="toggleHouse()" aria-label="Include Dream House in calculations">
                            <label for="houseEnabled">Include</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">House Price</label>
                    <input type="number" id="housePrice" class="form-input" value="400000" step="1000" oninput="calculate()">
                    <div class="form-helper">Total purchase price including closing costs</div>
                </div>
                <div class="input-group">
                    <div class="form-group">
                        <label class="form-label">Interest Rate (%)</label>
                        <input type="number" id="houseInterestRate" class="form-input" value="6" step="0.1" oninput="calculate()">
                        <div class="form-helper">Mortgage APR</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Loan Term (years)</label>
                        <input type="number" id="houseLoanYears" class="form-input" value="30" step="1" oninput="calculate()">
                        <div class="form-helper">Typical 15, 20, or 30 years</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Purchase Year</label>
                    <select id="housePurchaseYear" class="form-input" data-year-options data-default="0" onchange="calculate()"></select>
                    <div class="form-helper">Down payment uses accumulated savings from previous years</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Monthly Bills (Taxes, etc.)</label>
                    <input type="number" id="houseAdditionalBills" class="form-input" value="2000" step="100" oninput="calculate()">
                    <div class="form-helper">Property taxes, insurance, HOA, maintenance</div>
                </div>
            </div>
        </div>

        <div class="summary-grid" id="summaryCards"></div>

        <div class="chart-container">
            <div class="chart-title">Savings Projection Over 5 Years</div>
            <div class="chart-description">This line chart displays your cumulative savings projection over a 5-year period. The line shows how your savings accumulate (or deplete) month by month. Values above zero indicate positive savings, while values below zero indicate you're spending more than you earn. Hover over data points to see exact values.</div>
            <div class="chart-wrapper">
                <canvas id="savingsChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">Cumulative Spending by Category</div>
            <div class="chart-description">This chart displays cumulative spending totals for each category at yearly intervals (Year 1 through Year 5). Each bar shows the total amount spent in that category up to that year. Categories are labeled with their cumulative spending amounts, helping you see which categories consume the most of your budget over time.</div>
            <div class="chart-wrapper">
                <canvas id="spendingChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">5-Year Total Spending by Category (Treemap)</div>
            <div class="chart-description">This treemap visualization shows your total 5-year spending by category, where larger rectangles indicate higher spending. The size and color intensity of each box represents the proportion of your total spending. Click or hover over any box to see detailed category information and exact dollar amounts.</div>
            <div class="treemap-container">
                <svg class="treemap-svg" id="treemapSvg"></svg>
                <div class="treemap-tooltip" id="treemapTooltip"></div>
            </div>
            <div class="treemap-legend" id="treemapLegend">
                <!-- Legend will be generated here -->
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">Yearly Financial Summary</div>
            <div class="chart-description">This table provides a comprehensive year-by-year breakdown of your financial situation. It shows annual income, total spending, annual savings (or deficit), cumulative savings over time, and your financial status. Use this to identify trends and see which years may be challenging or favorable based on your planned major purchases.</div>
            <table>
                <thead>
                    <tr>
                        <th>Year</th>
                        <th>Annual Income</th>
                        <th>Annual Spending</th>
                        <th>Annual Savings</th>
                        <th>Cumulative Savings</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="yearlyTable">
                </tbody>
            </table>
        </div>

        <!-- AI Analysis Section -->
        <div class="panel ai-analysis-panel">
            <div class="ai-analysis-header">
                <div class="ai-analysis-title-wrapper">
                    <h2 class="ai-analysis-title">AI Financial Viability Analysis</h2>
                    <div class="ai-analysis-actions">
                        <span class="coming-soon-badge">BETA</span>
                        <button class="ai-rerun-button" id="aiRerunButton">
                            <span class="ai-rerun-text">RERUN ANALYSIS</span>
                            <span class="ai-rerun-loading u-hidden">ANALYZING...</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="ai-analysis-preview">
                <div class="ai-grade-section">
                    <div class="ai-grade-label">Viability Grade</div>
                    <div class="ai-grade-display">
                        <span class="ai-grade-letter" id="aiGradeLetter">B+</span>
                        <div class="ai-grade-meter">
                            <div class="ai-grade-bar"></div>
                        </div>
                        <span class="ai-grade-score">78/100</span>
                    </div>
                </div>
                <div class="ai-insights">
                    <div class="ai-insight-item">
                        <div class="ai-insight-icon">✓</div>
                        <div class="ai-insight-content">
                            <div class="ai-insight-title">Savings Trajectory</div>
                            <div class="ai-insight-text">Your projected savings show consistent growth across all 5 years, with positive cash flow maintained even after major purchases.</div>
                        </div>
                    </div>
                    <div class="ai-insight-item">
                        <div class="ai-insight-icon">⚠</div>
                        <div class="ai-insight-content">
                            <div class="ai-insight-title">Expense Ratio</div>
                            <div class="ai-insight-text">Your spending-to-income ratio is at 72%, which is slightly above optimal. Consider reducing discretionary spending in categories like Entertainment or Dining.</div>
                        </div>
                    </div>
                    <div class="ai-insight-item">
                        <div class="ai-insight-icon">✓</div>
                        <div class="ai-insight-content">
                            <div class="ai-insight-title">Debt Management</div>
                            <div class="ai-insight-text">Major purchases are well-timed and manageable. Your car and house payments represent sustainable portions of your income.</div>
                        </div>
                    </div>
                    <div class="ai-insight-item">
                        <div class="ai-insight-icon">→</div>
                        <div class="ai-insight-content">
                            <div class="ai-insight-title">Optimization Opportunity</div>
                            <div class="ai-insight-text">Delaying the house purchase by 6 months could increase your cumulative savings by approximately $12,500 while maintaining your lifestyle goals.</div>
                        </div>
                    </div>
                </div>
                <div class="ai-analysis-footer">
                    <div class="ai-analysis-note">AI-powered financial analysis will provide personalized insights and actionable recommendations based on your complete financial profile.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let budgetItems = [];
        let savingsChart = null;
        let spendingChart = null;
        let incomeEnabled = true;

        const instructionItems = [
            {
                title: 'Income Control',
                text: 'Drag the vertical slider or click the amount to edit. Maximum income is $50,000/month.'
            },
            {
                title: 'Budget Items',
                text: 'Each slider controls a spending category. Drag the handle or click the amount to edit. Maximum per item is $5,000/month.'
            },
            {
                title: 'Adding Items',
                text: 'Click "Add Budget Item" to create new spending categories. Click the × button to remove items.'
            },
            {
                title: 'Major Purchases',
                text: 'Toggle Dream Car and Dream House to include/exclude them. Adjust purchase year to see how timing affects your savings.'
            },
            {
                title: 'Charts & Data',
                text: 'Scroll down to see savings projections, spending breakdowns, and yearly financial summaries. All updates in real-time.'
            },
            {
                title: 'Affordability',
                text: 'The banner at the top shows if you can afford your lifestyle. Negative savings are indicated by a darker appearance over 5 years.'
            }
        ];

        const summaryCardConfig = [
            { id: 'monthlySavings', label: 'Monthly Savings' },
            { id: 'totalSavings', label: '5-Year Total Savings' },
            { id: 'carPayment', label: 'Monthly Car Payment' },
            { id: 'housePayment', label: 'Monthly House Payment' }
        ];

        const purchaseYearOptions = [
            { value: '0', label: 'Year 0 (Before savings start)' },
            { value: '1', label: 'Year 1' },
            { value: '2', label: 'Year 2' },
            { value: '3', label: 'Year 3' },
            { value: '4', label: 'Year 4' },
            { value: '5', label: 'Year 5' }
        ];

        function renderInstructions() {
            const container = document.getElementById('instructionsContent');
            if (!container) return;
            container.innerHTML = instructionItems.map(({ title, text }) => `
                <div class="instruction-item">
                    <div class="instruction-item-title">${title}</div>
                    <div class="instruction-item-text">${text}</div>
                </div>
            `).join('');
        }

        function renderSummaryCards() {
            const container = document.getElementById('summaryCards');
            if (!container) return;
            container.innerHTML = summaryCardConfig.map(({ id, label }) => `
                <div class="summary-card">
                    <div class="summary-card-label">${label}</div>
                    <div class="summary-card-value" id="${id}">$0</div>
                </div>
            `).join('');
        }

        function populatePurchaseYearSelects() {
            const optionsMarkup = purchaseYearOptions.map(({ value, label }) => `<option value="${value}">${label}</option>`).join('');
            document.querySelectorAll('[data-year-options]').forEach((select) => {
                select.innerHTML = optionsMarkup;
                const defaultValue = select.dataset.default ?? purchaseYearOptions[0].value;
                select.value = defaultValue;
            });
        }

        function initStaticSections() {
            renderSummaryCards();
            renderInstructions();
            populatePurchaseYearSelects();
        }

        // Default budget items
        const defaultBudgetItems = [
            { name: 'Bills & Utilities', amount: 808.63, enabled: true },
            { name: 'Dining & Drinks', amount: 798.88, enabled: true },
            { name: 'Groceries', amount: 452.76, enabled: true },
            { name: 'Auto & Transport', amount: 425.94, enabled: true },
            { name: 'Entertainment & Rec.', amount: 276.73, enabled: true },
            { name: 'Shopping', amount: 220.65, enabled: true },
            { name: 'Fees', amount: 216.93, enabled: true },
            { name: 'Travel & Vacation', amount: 201.08, enabled: true },
            { name: 'Health & Wellness', amount: 141.99, enabled: true },
            { name: 'Home & Garden', amount: 70.00, enabled: true },
            { name: 'Software & Tech', amount: 7.99, enabled: true }
        ];

        function initBudgetItems() {
            budgetItems = [...defaultBudgetItems];
            renderBudgetItems();
        }

        function renderBudgetItems() {
            const container = document.getElementById('budgetItems');
            container.innerHTML = '';
            
            // First, render the income item
            const incomeValue = parseFloat(document.getElementById('monthlyIncome').value) || 9593.42;
            const incomeDiv = document.createElement('div');
            incomeDiv.className = 'budget-item income-item' + (incomeEnabled === false ? ' disabled' : '');
            const incomeMaxValue = 50000;
            const incomeFaderWidth = (incomeValue / incomeMaxValue) * 100;
            const incomeHandleLeft = (incomeFaderWidth / 100 * 120) - 8;
            const incomeToggleIcon = incomeEnabled ? '✓' : '✗';
            
            incomeDiv.innerHTML = `
                <div class="budget-item-content">
                    <div class="budget-item-top">
                        <input class="form-input budget-item-input budget-name-input budget-name-input--readonly budget-item-name" value="Income"
                               placeholder="Income"
                               readonly
                               ${!incomeEnabled ? 'disabled' : ''}>
                    </div>
                    <div class="budget-item-amount-row">
                        <span class="budget-amount-display income-amount-display${incomeEnabled ? '' : ' is-disabled'}" id="incomeAmountDisplay" onclick="${incomeEnabled ? 'editIncomeAmount()' : ''}">$${incomeValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</span>
                    </div>
                    <div class="budget-item-slider-row">
                        <div class="budget-slider-container${incomeEnabled ? '' : ' is-disabled'}" id="slider-container-income" onmousedown="${incomeEnabled ? 'startIncomeFaderDrag(event)' : ''}" ontouchstart="${incomeEnabled ? 'startIncomeFaderDrag(event)' : ''}">
                            <div class="fader-track income-fader-track" id="income-fader-track">
                                <div class="fader-level income-fader-level" id="income-fader-level" style="width: ${incomeFaderWidth}%"></div>
                                <div class="fader-handle income-fader-handle" id="income-fader-handle" style="left: ${incomeHandleLeft}px"></div>
                            </div>
                        </div>
                    </div>
                    <div class="budget-item-toggle-row">
                        <div class="toggle-switch ${incomeEnabled ? 'enabled' : ''}" role="switch" aria-checked="${incomeEnabled ? 'true' : 'false'}" onclick="toggleIncome()" title="${incomeEnabled ? 'Disable' : 'Enable'} income">
                            <div class="toggle-thumb"></div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(incomeDiv);
            if (incomeEnabled) {
                setTimeout(() => updateIncomeFaderVisuals(), 0);
            }
            
            // Then render budget items
            budgetItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'budget-item' + (item.enabled === false ? ' disabled' : '');
                
                // Fixed max value of $5,000 per month
                const maxValue = 5000;
                const minValue = 0;
                
                const faderWidth = (item.amount / maxValue) * 100;
                const handleLeft = (faderWidth / 100 * 120) - 8; // Will be corrected after render by updateFaderVisuals
                const isEnabled = item.enabled !== false;
                const toggleIcon = isEnabled ? '✓' : '✗';

                div.innerHTML = `
                    <div class="budget-item-content">
                        <div class="budget-item-top">
                            <input class="form-input budget-item-input budget-name-input budget-item-name" value="${item.name}"
                                   placeholder="Budget item name"
                                   oninput="updateBudgetItem(${index}, 'name', this.value)"
                                   ${!isEnabled ? 'disabled' : ''}>
                        </div>
                        <div class="budget-item-amount-row">
                            <span class="budget-amount-display${isEnabled ? '' : ' is-disabled'}" id="budget-amount-${index}" onclick="${isEnabled ? `editBudgetAmount(${index})` : ''}">$${parseFloat(item.amount).toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</span>
                        </div>
                        <div class="budget-item-slider-row">
                            <div class="budget-slider-container${isEnabled ? '' : ' is-disabled'}" id="slider-container-${index}" onmousedown="${isEnabled ? `startFaderDrag(event, ${index})` : ''}" ontouchstart="${isEnabled ? `startFaderDrag(event, ${index})` : ''}">
                                <div class="fader-track" id="fader-track-${index}">
                                    <div class="fader-level" id="fader-level-${index}" style="width: ${faderWidth}%"></div>
                                    <div class="fader-handle" id="fader-handle-${index}" style="left: ${handleLeft}px"></div>
                                </div>
                            </div>
                        </div>
                        <div class="budget-item-toggle-row">
                            <div class="toggle-switch ${isEnabled ? 'enabled' : ''}" role="switch" aria-checked="${isEnabled ? 'true' : 'false'}" onclick="toggleBudgetItem(${index})" title="${isEnabled ? 'Disable' : 'Enable'} item">
                                <div class="toggle-thumb"></div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(div);

                // Update fader visuals after DOM insertion to get correct dimensions
                if (isEnabled) {
                    setTimeout(() => updateFaderVisuals(index), 0);
                }
            });
        }

        function updateBudgetItem(index, field, value) {
            budgetItems[index][field] = field === 'amount' ? value : value;
            calculate();
        }

        function updateBudgetSlider(index, value, element) {
            const maxValue = 5000;
            budgetItems[index].amount = parseFloat(value) || 0;

            updateFaderVisuals(index);
            updateBudgetDisplay(index);
            calculate();
        }

        function addBudgetItem() {
            budgetItems.push({ name: 'New Item', amount: 0, enabled: true });
            renderBudgetItems();
        }

        function toggleIncome() {
            incomeEnabled = !incomeEnabled;
            renderBudgetItems();
            calculate();
        }

        function toggleBudgetItem(index) {
            if (budgetItems[index]) {
                budgetItems[index].enabled = budgetItems[index].enabled === false ? true : false;
                renderBudgetItems();
                calculate();
            }
        }

        function updateIncomeSlider(value) {
            const incomeValue = parseFloat(value) || 0;
            const maxValue = 50000;
            document.getElementById('monthlyIncome').value = incomeValue;
            const displayElement = document.getElementById('incomeAmountDisplay');
            if (displayElement) {
                displayElement.textContent = '$' + incomeValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
            }
            updateIncomeFaderVisuals();
            calculate();
        }

        function updateIncomeFaderVisuals() {
            const incomeValue = parseFloat(document.getElementById('monthlyIncome').value) || 0;
            const maxValue = 50000;
            const faderWidth = (incomeValue / maxValue) * 100;
            const track = document.getElementById('income-fader-track');
            const trackWidth = track ? track.offsetWidth : 120;
            let handleLeft = (faderWidth / 100 * trackWidth) - 8;
            handleLeft = Math.max(-8, Math.min(trackWidth - 8, handleLeft));

            const faderLevel = document.getElementById('income-fader-level');
            const faderHandle = document.getElementById('income-fader-handle');

            if (faderLevel) {
                faderLevel.style.width = faderWidth + '%';
            }
            if (faderHandle) {
                faderHandle.style.left = handleLeft + 'px';
            }
        }

        function editIncomeAmount() {
            const displayElement = document.getElementById('incomeAmountDisplay');
            const hiddenInput = document.getElementById('monthlyIncome');
            const slider = document.getElementById('monthlyIncomeSlider');
            
            if (!displayElement || displayElement.classList.contains('editing')) return;
            
            const currentValue = parseFloat(hiddenInput.value) || 0;
            
            // Replace display with input field
            const input = document.createElement('input');
            input.type = 'number';
            input.id = 'incomeAmountDisplay';
            input.value = currentValue;
            input.className = 'income-amount-display editing';
            input.style.width = displayElement.offsetWidth + 'px';
            input.onblur = function() {
                finishEditingIncome(this.value, hiddenInput, slider);
            };
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            };
            input.onfocus = function() {
                this.select();
            };
            
            displayElement.parentNode.replaceChild(input, displayElement);
            input.focus();
            input.select();
        }

        function finishEditingIncome(value, hiddenInput, slider) {
            const numValue = parseFloat(value) || 0;
            const maxValue = 50000;
            const clampedValue = Math.max(0, Math.min(maxValue, numValue));
            
            hiddenInput.value = clampedValue;
            if (slider) slider.value = clampedValue;
            updateIncomeFaderVisuals();
            
            // Find the input that's currently being edited and replace it
            const editingInput = document.getElementById('incomeAmountDisplay');
            if (editingInput) {
                const displayElement = document.createElement('span');
                displayElement.id = 'incomeAmountDisplay';
                displayElement.className = 'income-amount-display';
                displayElement.textContent = '$' + clampedValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
                displayElement.onclick = editIncomeAmount;
                editingInput.parentNode.replaceChild(displayElement, editingInput);
            }
            
            calculate();
        }

        function updateIncomeFromInput(value) {
            const incomeValue = parseFloat(value) || 0;
            const maxValue = 50000;
            const clampedValue = Math.max(0, Math.min(maxValue, incomeValue));
            
            const slider = document.getElementById('monthlyIncomeSlider');
            if (slider) slider.value = clampedValue;
            const displayElement = document.getElementById('incomeAmountDisplay');
            if (displayElement) {
                displayElement.textContent = '$' + clampedValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
            }
            updateIncomeFaderVisuals();
            calculate();
        }

        function editBudgetAmount(index) {
            const displayElement = document.getElementById(`budget-amount-${index}`);
            const budgetItem = displayElement.closest('.budget-item');
            const slider = budgetItem ? budgetItem.querySelector('.budget-slider') : null;
            
            if (!displayElement || displayElement.classList.contains('editing')) return;
            
            const currentValue = budgetItems[index].amount || 0;
            
            // Replace display with input field
            const input = document.createElement('input');
            input.type = 'number';
            input.id = `budget-amount-${index}`;
            input.value = currentValue;
            input.className = 'budget-amount-display editing';
            input.style.width = displayElement.offsetWidth + 'px';
            input.step = '1';
            input.onblur = function() {
                finishEditingBudget(index, this.value, slider);
            };
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            };
            input.onfocus = function() {
                this.select();
            };
            
            displayElement.parentNode.replaceChild(input, displayElement);
            input.focus();
            input.select();
        }

        function finishEditingBudget(index, value, slider) {
            const maxValue = 5000;
            const numValue = parseFloat(value) || 0;
            const clampedValue = Math.max(0, Math.min(maxValue, numValue));
            
            budgetItems[index].amount = clampedValue;
            if (slider) {
                slider.value = clampedValue;
            }
            
            // Update fader level
            const faderLevel = document.getElementById(`fader-level-${index}`);
            if (faderLevel) {
                const faderHeight = (clampedValue / maxValue) * 100;
                faderLevel.style.height = faderHeight + '%';
            }
            
            // Find the input that's currently being edited and replace it
            const editingInput = document.getElementById(`budget-amount-${index}`);
            if (editingInput) {
                const displayElement = document.createElement('span');
                displayElement.id = `budget-amount-${index}`;
                displayElement.className = 'budget-amount-display';
                displayElement.textContent = '$' + clampedValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
                displayElement.onclick = function() { editBudgetAmount(index); };
                editingInput.parentNode.replaceChild(displayElement, editingInput);
            }
            
            calculate();
        }

        // Fader drag functionality
        let isDragging = false;
        let dragIndex = -1;
        let dragStartX = 0;
        let dragStartValue = 0;
        
        // Income fader drag functionality
        let isIncomeDragging = false;
        let incomeDragStartX = 0;
        let incomeDragStartValue = 0;

        function startIncomeFaderDrag(event) {
            event.preventDefault();
            event.stopPropagation();
            isIncomeDragging = true;
            const currentValue = parseFloat(document.getElementById('monthlyIncome').value) || 0;
            const clientX = event.touches ? event.touches[0].clientX : event.clientX;
            incomeDragStartX = clientX;
            incomeDragStartValue = currentValue;
            document.addEventListener('mousemove', dragIncomeFader);
            document.addEventListener('mouseup', stopIncomeFaderDrag);
            document.addEventListener('touchmove', dragIncomeFader, { passive: false });
            document.addEventListener('touchend', stopIncomeFaderDrag);
        }

        function dragIncomeFader(event) {
            if (!isIncomeDragging) return;
            event.preventDefault();

            const track = document.getElementById('income-fader-track');
            const trackWidth = track ? track.offsetWidth : 120;
            const clientX = event.touches ? event.touches[0].clientX : event.clientX;
            const deltaX = clientX - incomeDragStartX;
            const deltaPercent = deltaX / trackWidth;

            const maxValue = 50000;
            let newValue = incomeDragStartValue + (deltaPercent * maxValue);
            newValue = Math.max(0, Math.min(maxValue, Math.round(newValue / 100) * 100));

            document.getElementById('monthlyIncome').value = newValue;
            const slider = document.getElementById('monthlyIncomeSlider');
            if (slider) slider.value = newValue;
            updateIncomeFaderVisuals();
            
            const displayElement = document.getElementById('incomeAmountDisplay');
            if (displayElement && !displayElement.classList.contains('editing')) {
                displayElement.textContent = '$' + newValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
            }
            calculate();
        }

        function stopIncomeFaderDrag() {
            isIncomeDragging = false;
            document.removeEventListener('mousemove', dragIncomeFader);
            document.removeEventListener('mouseup', stopIncomeFaderDrag);
            document.removeEventListener('touchmove', dragIncomeFader);
            document.removeEventListener('touchend', stopIncomeFaderDrag);
        }

        function startFaderDrag(event, index) {
            event.preventDefault();
            isDragging = true;
            dragIndex = index;
            const clientX = event.touches ? event.touches[0].clientX : event.clientX;
            dragStartX = clientX;
            dragStartValue = budgetItems[index].amount;
            document.addEventListener('mousemove', dragFader);
            document.addEventListener('mouseup', stopFaderDrag);
            document.addEventListener('touchmove', dragFader, { passive: false });
            document.addEventListener('touchend', stopFaderDrag);
        }

        function dragFader(event) {
            if (!isDragging || dragIndex === -1) return;
            event.preventDefault();

            const track = document.getElementById(`fader-track-${dragIndex}`);
            const trackWidth = track ? track.offsetWidth : 120;
            const clientX = event.touches ? event.touches[0].clientX : event.clientX;
            const deltaX = clientX - dragStartX;
            const deltaPercent = deltaX / trackWidth;

            const maxValue = 5000;
            let newValue = dragStartValue + (deltaPercent * maxValue);
            newValue = Math.max(0, Math.min(maxValue, Math.round(newValue / 10) * 10));

            budgetItems[dragIndex].amount = newValue;
            updateFaderVisuals(dragIndex);
            updateBudgetDisplay(dragIndex);
            calculate();
        }

        function stopFaderDrag() {
            isDragging = false;
            dragIndex = -1;
            document.removeEventListener('mousemove', dragFader);
            document.removeEventListener('mouseup', stopFaderDrag);
            document.removeEventListener('touchmove', dragFader);
            document.removeEventListener('touchend', stopFaderDrag);
        }

        function updateFaderVisuals(index) {
            const maxValue = 5000;
            const faderWidth = (budgetItems[index].amount / maxValue) * 100;
            const track = document.getElementById(`fader-track-${index}`);
            const trackWidth = track ? track.offsetWidth : 120;
            const handleLeft = (faderWidth / 100 * trackWidth) - 8;

            const faderLevel = document.getElementById(`fader-level-${index}`);
            const faderHandle = document.getElementById(`fader-handle-${index}`);

            if (faderLevel) {
                faderLevel.style.width = faderWidth + '%';
            }
            if (faderHandle) {
                faderHandle.style.left = handleLeft + 'px';
            }
        }

        function updateBudgetDisplay(index) {
            const displayElement = document.getElementById(`budget-amount-${index}`);
            if (displayElement && !displayElement.classList.contains('editing')) {
                displayElement.textContent = '$' + budgetItems[index].amount.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
            }
        }

        function toggleCar() {
            const carEnabled = document.getElementById('carEnabled').checked;
            const carPanel = document.getElementById('carPanel');
            if (carEnabled) {
                carPanel.classList.remove('disabled');
            } else {
                carPanel.classList.add('disabled');
            }
            calculate();
        }

        function toggleHouse() {
            const houseEnabled = document.getElementById('houseEnabled').checked;
            const housePanel = document.getElementById('housePanel');
            if (houseEnabled) {
                housePanel.classList.remove('disabled');
            } else {
                housePanel.classList.add('disabled');
            }
            calculate();
        }

        function calculateLoanPayment(principal, annualRate, months) {
            const monthlyRate = annualRate / 12 / 100;
            if (monthlyRate === 0) return principal / months;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
        }

        function calculate() {
            const monthlyIncome = incomeEnabled ? (parseFloat(document.getElementById('monthlyIncome').value) || 0) : 0;
            const monthlySpending = budgetItems.reduce((sum, item) => {
                if (item.enabled === false) return sum;
                return sum + (parseFloat(item.amount) || 0);
            }, 0);
            const baseMonthlySavings = monthlyIncome - monthlySpending;

            // Car loan
            const carEnabled = document.getElementById('carEnabled').checked;
            const carPrice = parseFloat(document.getElementById('carPrice').value) || 0;
            const carInterestRate = parseFloat(document.getElementById('carInterestRate').value) || 0;
            const carLoanMonths = parseInt(document.getElementById('carLoanMonths').value) || 60;
            const carPurchaseYear = parseInt(document.getElementById('carPurchaseYear').value) || 0;
            const carPurchaseMonth = carPurchaseYear * 12; // Convert year to month
            const carMonthlyPayment = carEnabled && carPrice > 0 ? calculateLoanPayment(carPrice, carInterestRate, carLoanMonths) : 0;

            // House loan
            const houseEnabled = document.getElementById('houseEnabled').checked;
            const housePrice = parseFloat(document.getElementById('housePrice').value) || 0;
            const houseInterestRate = parseFloat(document.getElementById('houseInterestRate').value) || 0;
            const houseLoanYears = parseInt(document.getElementById('houseLoanYears').value) || 30;
            const houseLoanMonths = houseLoanYears * 12;
            const housePurchaseYear = parseInt(document.getElementById('housePurchaseYear').value) || 0;
            const housePurchaseMonth = housePurchaseYear * 12; // Convert year to month
            const houseAdditionalBills = parseFloat(document.getElementById('houseAdditionalBills').value) || 0;

            // Calculate Year 1 savings for house down payment if needed
            let year1Savings = 0;
            const annualReturnRate = 0.04;
            const monthlyRate = annualReturnRate / 12;

            if (houseEnabled && housePurchaseYear >= 1) {
                // Calculate savings accumulated before house purchase (Year 0 to housePurchaseYear-1)
                const monthsBeforeHouse = housePurchaseYear * 12;
                for (let month = 1; month <= monthsBeforeHouse; month++) {
                    let monthlySavingsThisMonth = baseMonthlySavings;
                    if (carEnabled && month > carPurchaseMonth && month <= carPurchaseMonth + carLoanMonths) {
                        monthlySavingsThisMonth -= carMonthlyPayment;
                    }
                    year1Savings += monthlySavingsThisMonth;
                    year1Savings = year1Savings * (1 + monthlyRate);
                }
            }
            // If house purchased at Year 0, no savings available yet for down payment
            // If house purchased at Year 1+, use accumulated savings

            const houseDownPayment = houseEnabled && housePurchaseYear === 0 ? 0 : (houseEnabled ? Math.min(year1Savings, housePrice) : 0);
            const houseLoanAmount = Math.max(0, housePrice - houseDownPayment);
            const houseMonthlyPayment = houseEnabled && houseLoanAmount > 0 ? calculateLoanPayment(houseLoanAmount, houseInterestRate, houseLoanMonths) : 0;

            // Update displays
            document.getElementById('carPayment').textContent = '$' + carMonthlyPayment.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('housePayment').textContent = '$' + houseMonthlyPayment.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});

            // Calculate 5-year projection
            const years = 5;
            const months = years * 12;
            let savingsBalance = 0;
            const savingsData = [];
            const labels = [];

            for (let month = 0; month <= months; month++) {
                if (month > 0) {
                    let monthlySavingsThisMonth = baseMonthlySavings;

                    // Subtract car loan payment
                    if (carEnabled && month > carPurchaseMonth && month <= carPurchaseMonth + carLoanMonths) {
                        monthlySavingsThisMonth -= carMonthlyPayment;
                    }

                    // Subtract house loan payment
                    if (houseEnabled && month > housePurchaseMonth) {
                        monthlySavingsThisMonth -= houseMonthlyPayment;
                        monthlySavingsThisMonth -= houseAdditionalBills;
                    }

                    // Deduct down payments
                    if (houseEnabled && month === housePurchaseMonth && houseDownPayment > 0) {
                        savingsBalance -= houseDownPayment;
                    }

                    savingsBalance += monthlySavingsThisMonth;
                    savingsBalance = savingsBalance * (1 + monthlyRate);
                }
                savingsData.push(savingsBalance);

                if (month % 12 === 0 || month === months) {
                    labels.push(`Year ${Math.floor(month / 12)}`);
                } else if (month % 3 === 0) {
                    labels.push('');
                } else {
                    labels.push('');
                }
            }

            // Update affordability banner
            const finalSavings = savingsBalance;
            const banner = document.getElementById('affordabilityBanner');
            const bannerTitle = document.getElementById('affordabilityTitle');
            const bannerText = document.getElementById('affordabilityDesc');
            const bannerAmount = document.getElementById('finalSavings');
            const monthlySavingsAfterLoans = baseMonthlySavings - (carMonthlyPayment > 0 && months > carPurchaseMonth && months <= carPurchaseMonth + carLoanMonths ? carMonthlyPayment : 0) - (houseMonthlyPayment > 0 && months > housePurchaseMonth ? houseMonthlyPayment + houseAdditionalBills : 0);

            if (finalSavings < 0 || monthlySavingsAfterLoans < 0) {
                banner.className = 'affordability-banner negative';
                bannerTitle.textContent = 'You Cannot Afford This Lifestyle';
                bannerText.textContent = 'Your savings will go negative. Consider adjusting your purchases or budget.';
            } else {
                banner.className = 'affordability-banner';
                bannerTitle.textContent = 'You Can Afford This Lifestyle';
                bannerText.textContent = 'Your projected savings remain positive over 5 years';
            }
            bannerAmount.textContent = '$' + finalSavings.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            bannerAmount.className = finalSavings < 0 ? 'affordability-amount' : 'affordability-amount';

            document.getElementById('monthlySavings').textContent = '$' + monthlySavingsAfterLoans.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('monthlySavings').className = 'summary-card-value ' + (monthlySavingsAfterLoans >= 0 ? 'positive' : 'negative');
            document.getElementById('totalSavings').textContent = '$' + finalSavings.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('totalSavings').className = 'summary-card-value ' + (finalSavings >= 0 ? 'positive' : 'negative');

            // Update charts
            updateSavingsChart(labels, savingsData);
            updateSpendingChart(labels, budgetItems, carMonthlyPayment, carPurchaseMonth, carLoanMonths, carEnabled, houseMonthlyPayment, housePurchaseMonth, houseAdditionalBills, houseEnabled, months);
            updateBentoBox(budgetItems, carMonthlyPayment, carPurchaseMonth, carLoanMonths, carEnabled, houseMonthlyPayment, housePurchaseMonth, houseAdditionalBills, houseEnabled, months);
            updateYearlyTable(monthlyIncome, baseMonthlySavings, carMonthlyPayment, carPurchaseMonth, carLoanMonths, carEnabled, houseMonthlyPayment, housePurchaseMonth, houseAdditionalBills, houseDownPayment, houseEnabled, years, months, monthlyRate);
        }

        function updateSavingsChart(labels, data) {
            const ctx = document.getElementById('savingsChart').getContext('2d');
            
            if (savingsChart) {
                savingsChart.destroy();
            }

            const minValue = Math.min(...data);
            const maxValue = Math.max(...data);
            const isNegative = minValue < 0;

            savingsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cumulative Savings',
                        data: data,
                        borderColor: '#ffffff',
                        backgroundColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#ffffff',
                                font: {
                                    size: 12,
                                    weight: 500
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { 
                                display: true, 
                                text: 'Time (Years)',
                                color: '#ffffff',
                                font: {
                                    size: 12,
                                    weight: 500
                                }
                            },
                            grid: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#b0b0b0',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Savings ($)',
                                color: '#ffffff',
                                font: {
                                    size: 12,
                                    weight: 500
                                }
                            },
                            grid: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#b0b0b0',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateSpendingChart(labels, budgetItems, carPayment, carMonth, carMonths, carEnabled, housePayment, houseMonth, houseBills, houseEnabled, totalMonths) {
            const ctx = document.getElementById('spendingChart').getContext('2d');
            
            if (spendingChart) {
                spendingChart.destroy();
            }

            // Year intervals: 12, 24, 36, 48, 60 months
            const yearLabels = ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'];
            const yearMonths = [12, 24, 36, 48, 60];
            
            // Generate unique colors for each category
            const categoryColors = [
                'rgba(255, 255, 255, 0.9)',
                'rgba(230, 230, 230, 0.85)',
                'rgba(200, 200, 200, 0.8)',
                'rgba(170, 170, 170, 0.75)',
                'rgba(140, 140, 140, 0.7)',
                'rgba(110, 110, 110, 0.65)',
                'rgba(255, 255, 255, 0.85)',
                'rgba(220, 220, 220, 0.8)',
                'rgba(190, 190, 190, 0.75)',
                'rgba(160, 160, 160, 0.7)',
                'rgba(130, 130, 130, 0.65)',
                'rgba(100, 100, 100, 0.6)',
                'rgba(80, 80, 80, 0.55)',
                'rgba(60, 60, 60, 0.5)'
            ];

            const borderColors = ['#ffffff', '#e0e0e0', '#c0c0c0', '#a0a0a0', '#808080', '#606060', '#ffffff', '#d0d0d0', '#b0b0b0', '#909090', '#707070', '#505050', '#404040', '#303030'];

            const datasets = [];

            // Calculate cumulative spending for each category at year intervals
            budgetItems.forEach((item, index) => {
                const data = yearMonths.map(month => {
                    return (parseFloat(item.amount) || 0) * month;
                });
                
                datasets.push({
                    label: item.name,
                    data: data,
                    backgroundColor: categoryColors[index % categoryColors.length],
                    borderColor: borderColors[index % borderColors.length],
                    borderWidth: 1
                });
            });

            // Add car payment
            if (carEnabled && carPayment > 0) {
                const data = yearMonths.map(month => {
                    let total = 0;
                    for (let m = 1; m <= month; m++) {
                        if (m > carMonth && m <= carMonth + carMonths) {
                            total += carPayment;
                        }
                    }
                    return total;
                });
                
                datasets.push({
                    label: 'Car Loan Payment',
                    data: data,
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#ffffff',
                    borderWidth: 1.5
                });
            }

            // Add house payment
            if (houseEnabled && (housePayment > 0 || houseBills > 0)) {
                const data = yearMonths.map(month => {
                    let total = 0;
                    for (let m = 1; m <= month; m++) {
                        if (m > houseMonth) {
                            total += housePayment;
                            total += houseBills;
                        }
                    }
                    return total;
                });
                
                datasets.push({
                    label: 'House Expenses',
                    data: data,
                    backgroundColor: 'rgba(230, 230, 230, 0.9)',
                    borderColor: '#e0e0e0',
                    borderWidth: 1.5
                });
            }

            spendingChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: yearLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { 
                                color: '#ffffff',
                                font: { size: 11, weight: 500 }, 
                                boxWidth: 12,
                                usePointStyle: true,
                                padding: 12
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1,
                            padding: 16,
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            titleFont: {
                                size: 13,
                                weight: 600
                            },
                            bodyFont: {
                                size: 12,
                                weight: 400
                            },
                            footerFont: {
                                size: 11,
                                weight: 500
                            },
                            footerColor: '#888888',
                            cornerRadius: 0,
                            displayColors: true,
                            boxPadding: 8,
                            usePointStyle: true,
                            callbacks: {
                                title: function(context) {
                                    return yearLabels[context[0].dataIndex] || '';
                                },
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    
                                    return `${label}: $${value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                                },
                                footer: function(tooltipItems) {
                                    let total = 0;
                                    tooltipItems.forEach(item => {
                                        total += item.parsed.y;
                                    });
                                    return `Total Cumulative: $${total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: false,
                            title: { 
                                display: true, 
                                text: 'Year Interval',
                                color: '#ffffff',
                                font: {
                                    family: 'JetBrains Mono',
                                    size: 11,
                                    weight: 500
                                }
                            },
                            grid: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#b0b0b0',
                                font: {
                                    family: 'JetBrains Mono',
                                    size: 11
                                }
                            }
                        },
                        y: {
                            stacked: false,
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'Cumulative Spending ($)',
                                color: '#ffffff',
                                font: {
                                    family: 'JetBrains Mono',
                                    size: 11,
                                    weight: 500
                                }
                            },
                            grid: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#b0b0b0',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateBentoBox(budgetItems, carPayment, carMonth, carMonths, carEnabled, housePayment, houseMonth, houseBills, houseEnabled, months) {
            const svg = d3.select('#treemapSvg');
            const tooltip = d3.select('#treemapTooltip');
            const legend = d3.select('#treemapLegend');
            
            // Clear existing content
            svg.selectAll('*').remove();
            legend.selectAll('*').remove();

            // Calculate 5-year totals for each category
            const categories = [];
            const totalMonths = months;

            // Add budget items
            budgetItems.forEach(item => {
                const monthlyAmount = parseFloat(item.amount) || 0;
                const total5Year = monthlyAmount * totalMonths;
                if (total5Year > 0) {
                    categories.push({
                        name: item.name,
                        value: total5Year
                    });
                }
            });

            // Add car loan payments
            if (carEnabled && carPayment > 0) {
                let carTotal = 0;
                for (let m = 1; m <= totalMonths; m++) {
                    if (m > carMonth && m <= carMonth + carMonths) {
                        carTotal += carPayment;
                    }
                }
                if (carTotal > 0) {
                    categories.push({
                        name: 'Car Loan Payments',
                        value: carTotal
                    });
                }
            }

            // Add house expenses
            if (houseEnabled && (housePayment > 0 || houseBills > 0)) {
                let houseTotal = 0;
                for (let m = 1; m <= totalMonths; m++) {
                    if (m > houseMonth) {
                        houseTotal += housePayment;
                        houseTotal += houseBills;
                    }
                }
                if (houseTotal > 0) {
                    categories.push({
                        name: 'House Expenses',
                        value: houseTotal
                    });
                }
            }

            if (categories.length === 0) return;

            // Calculate total spending
            const totalSpending = categories.reduce((sum, cat) => sum + cat.value, 0);

            // Darker gray color palette for better white label visibility
            const colors = [
                '#2a2a2a', '#353535', '#404040', '#4a4a4a', '#555555', '#606060',
                '#6b6b6b', '#757575', '#808080', '#252525', '#303030', '#3a3a3a',
                '#454545', '#505050', '#5a5a5a', '#656565', '#707070', '#7a7a7a',
                '#2f2f2f', '#383838', '#424242', '#4d4d4d', '#585858', '#636363'
            ];

            // Assign colors to categories
            categories.forEach((category, index) => {
                category.color = colors[index % colors.length];
                category.percentage = (category.value / totalSpending) * 100;
            });

            // Get container dimensions
            const container = document.querySelector('.treemap-container');
            const width = container.clientWidth - 16; // Account for padding
            const height = container.clientHeight - 16; // Account for padding

            // Create hierarchy for D3 treemap
            const root = {
                name: 'root',
                children: categories.map(cat => ({
                    name: cat.name,
                    value: cat.value,
                    color: cat.color,
                    percentage: cat.percentage
                }))
            };

            // Create treemap layout
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);

            const hierarchy = d3.hierarchy(root)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            treemap(hierarchy);

            // Create tooltip function
            const showTooltip = (event, d) => {
                const [x, y] = d3.pointer(event, container);
                tooltip
                    .style('left', (x + 10) + 'px')
                    .style('top', (y + 10) + 'px')
                    .html(`
                        <div class="treemap-tooltip-title">${d.data.name}</div>
                        <div class="treemap-tooltip-amount">$${d.data.value.toLocaleString(undefined, {maximumFractionDigits: 0})}</div>
                        <div>${d.data.percentage.toFixed(1)}% of total spending</div>
                    `)
                    .classed('show', true);
            };

            const hideTooltip = () => {
                tooltip.classed('show', false);
            };

            // Draw rectangles
            const cells = svg.selectAll('g')
                .data(hierarchy.leaves())
                .enter()
                .append('g')
                .attr('transform', d => `translate(${d.x0},${d.y0})`);

            cells.append('rect')
                .attr('class', 'treemap-rect')
                .attr('width', d => d.x1 - d.x0)
                .attr('height', d => d.y1 - d.y0)
                .attr('fill', d => d.data.color)
                .on('mousemove', showTooltip)
                .on('mouseout', hideTooltip);

            // Helper function to wrap text
            function wrapText(textElement, text, maxWidth, lineHeight, xPosition) {
                const words = text.split(/\s+/);
                let line = '';
                let tspan = textElement.append('tspan')
                    .attr('x', xPosition)
                    .attr('dy', '0')
                    .attr('dominant-baseline', 'hanging')
                    .text('');

                words.forEach((word, i) => {
                    const testLine = line + (line ? ' ' : '') + word;
                    const tspanNode = tspan.node();
                    if (tspanNode) {
                        tspanNode.textContent = testLine;
                        const testWidth = tspanNode.getComputedTextLength();
                        
                        if (testWidth > maxWidth && i > 0) {
                            tspan.text(line);
                            line = word;
                            tspan = textElement.append('tspan')
                                .attr('x', xPosition)
                                .attr('dy', lineHeight)
                                .attr('dominant-baseline', 'hanging')
                                .text(word);
                        } else {
                            line = testLine;
                            tspan.text(line);
                        }
                    }
                });
            }

            // Add text labels with wrapping
            cells.each(function(d) {
                const cell = d3.select(this);
                const boxWidth = d.x1 - d.x0;
                const boxHeight = d.y1 - d.y0;
                
                // Higher minimum size thresholds for better readability
                const minWidth = 140; // Minimum width to show labels
                const minHeight = 70; // Minimum height to show labels
                const minArea = 12000; // Minimum area (width * height)
                
                // Calculate area
                const area = boxWidth * boxHeight;
                
                // Only show labels if box meets all size requirements
                if (boxWidth >= minWidth && boxHeight >= minHeight && area >= minArea) {
                    const padding = 16;
                    const textAreaWidth = boxWidth - (padding * 2);
                    const lineHeight = 18;
                    const labelFontSize = boxWidth < 200 ? '11px' : '12px';
                    const amountFontSize = boxWidth < 200 ? '15px' : '17px';
                    const percentageFontSize = boxWidth < 200 ? '9px' : '10px';

                    // Category name with wrapping - centered vertically in available space
                    const labelText = cell.append('text')
                        .attr('class', 'treemap-text treemap-label')
                        .attr('x', padding)
                        .attr('y', padding)
                        .attr('dominant-baseline', 'hanging')
                        .attr('font-size', labelFontSize);
                    
                    wrapText(labelText, d.data.name, textAreaWidth, lineHeight, padding);

                    // Calculate total label height accurately
                    const labelLines = labelText.selectAll('tspan').size();
                    const labelHeight = padding + (labelLines * lineHeight);
                    
                    // Amount - show if there's enough space
                    if (boxHeight >= labelHeight + 36) {
                        cell.append('text')
                            .attr('class', 'treemap-text treemap-amount')
                            .attr('x', padding)
                            .attr('y', labelHeight + 8)
                            .attr('dominant-baseline', 'hanging')
                            .attr('font-size', amountFontSize)
                            .text('$' + d.data.value.toLocaleString(undefined, {maximumFractionDigits: 0}));
                        
                        // Percentage - show if there's enough space below amount
                        if (boxHeight >= labelHeight + 60) {
                            cell.append('text')
                                .attr('class', 'treemap-text treemap-percentage')
                                .attr('x', padding)
                                .attr('y', labelHeight + 32)
                                .attr('dominant-baseline', 'hanging')
                                .attr('font-size', percentageFontSize)
                                .text(d.data.percentage.toFixed(1) + '%');
                        }
                    } else if (boxHeight >= labelHeight + 20) {
                        // If not enough space for amount, try to show just the category name centered better
                        const availableHeight = boxHeight - padding;
                        const labelCenterY = padding + (availableHeight / 2) - ((labelLines * lineHeight) / 2);
                        labelText.attr('y', Math.max(padding, labelCenterY));
                    }
                }
                // Boxes below minimum size threshold don't show any labels
            });

            // Create legend
            categories.forEach((category, index) => {
                const legendItem = legend.append('div')
                    .attr('class', 'treemap-legend-item');

                legendItem.append('div')
                    .attr('class', 'treemap-legend-color')
                    .style('background-color', category.color);

                legendItem.append('span')
                    .text(`${category.name}: $${category.value.toLocaleString(undefined, {maximumFractionDigits: 0})} (${category.percentage.toFixed(1)}%)`);
            });
        }

        function updateYearlyTable(income, baseSavings, carPayment, carMonth, carMonths, carEnabled, housePayment, houseMonth, houseBills, houseDownPayment, houseEnabled, years, months, monthlyRate) {
            const tableBody = document.getElementById('yearlyTable');
            tableBody.innerHTML = '';
            let savingsBalance = 0;

            for (let year = 1; year <= years; year++) {
                const startMonth = (year - 1) * 12;
                const endMonth = year * 12;
                let annualSavings = 0;

                for (let month = startMonth + 1; month <= endMonth; month++) {
                    let monthlySavingsThisMonth = baseSavings;

                    if (carEnabled && month > carMonth && month <= carMonth + carMonths) {
                        monthlySavingsThisMonth -= carPayment;
                    }

                    if (houseEnabled && month > houseMonth) {
                        monthlySavingsThisMonth -= housePayment;
                        monthlySavingsThisMonth -= houseBills;
                    }

                    if (houseEnabled && month === houseMonth && houseDownPayment > 0) {
                        savingsBalance -= houseDownPayment;
                    }

                    annualSavings += monthlySavingsThisMonth;
                    savingsBalance += monthlySavingsThisMonth;
                    savingsBalance = savingsBalance * (1 + monthlyRate);
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>Year ${year}</strong></td>
                    <td>$${(income * 12).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>$${(baseSavings * 12 - annualSavings + income * 12).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>$${annualSavings.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td><strong>$${savingsBalance.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
                    <td><span class="badge ${savingsBalance >= 0 ? 'badge-success' : 'badge-danger'}">${savingsBalance >= 0 ? 'On Track' : 'Over Budget'}</span></td>
                `;
                tableBody.appendChild(row);
            }
        }

        // Instructions toggle function
        function toggleInstructions() {
            const content = document.getElementById('instructionsContent');
            const toggle = document.getElementById('instructionsToggle');
            const isExpanded = content.classList.contains('expanded');
            
            if (isExpanded) {
                content.classList.remove('expanded');
                toggle.textContent = 'Show Instructions';
                toggle.setAttribute('aria-expanded', 'false');
            } else {
                content.classList.add('expanded');
                toggle.textContent = 'Hide Instructions';
                toggle.setAttribute('aria-expanded', 'true');
            }
        }

        // Initialize header banner image
        function initHeaderBanner() {
            const image = document.getElementById('headerBannerImage');

            if (image) {
                if (image.complete && image.naturalWidth > 0) {
                    image.classList.add('loaded');
                } else {
                    image.addEventListener('load', function() {
                        image.classList.add('loaded');
                    });
                    image.addEventListener('error', function() {
                        image.style.display = 'none';
                    });
                }
            }
        }

        // Initialize countdown timer
        function initCountdownTimer() {
            const countdownTimer = document.getElementById('countdownTimer');
            if (!countdownTimer) return;

            // Set target date to one month from now
            const now = new Date();
            const targetDate = new Date(now.getTime() + (30 * 24 * 60 * 60 * 1000)); // 30 days from now

            function updateCountdown() {
                const now = new Date().getTime();
                const distance = targetDate.getTime() - now;

                if (distance > 0) {
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    document.getElementById('days').textContent = days.toString().padStart(2, '0');
                    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                } else {
                    // Countdown finished
                    document.getElementById('days').textContent = '00';
                    document.getElementById('hours').textContent = '00';
                    document.getElementById('minutes').textContent = '00';
                    document.getElementById('seconds').textContent = '00';
                }
            }

            // Update immediately
            updateCountdown();

            // Update every second
            setInterval(updateCountdown, 1000);
        }

        // Scroll animation observer
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const scrollObserver = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.classList.add('visible');
                    }, index * 50);
                    scrollObserver.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // Observe elements for scroll animations
        function initScrollAnimations() {
            // Base sections animate with scale-in
            const elementsToAnimate = document.querySelectorAll('.panel, .summary-card, .chart-container, .instructions-panel, .budget-item, .affordability-banner, .ai-analysis-panel, .footer');
            elementsToAnimate.forEach((el) => {
                el.classList.add('scroll-scale-in');
                scrollObserver.observe(el);
            });

            // AI section: staged fade-in for inner parts to enforce flow
            const aiStages = [
                '.ai-analysis-header',
                '.ai-grade-section',
                '.ai-insights',
                '.ai-analysis-footer'
            ];
            aiStages.forEach((selector, stageIndex) => {
                document.querySelectorAll(selector).forEach((el) => {
                    el.classList.add('scroll-fade-in');
                    // Stagger stage reveal via transition delay
                    el.style.transitionDelay = (stageIndex * 120) + 'ms';
                    scrollObserver.observe(el);
                });
            });
        }

        // Chart resize handler
        let resizeTimeout;
        function handleChartResize() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (savingsChart) {
                    savingsChart.resize();
                }
                if (spendingChart) {
                    spendingChart.resize();
                }
            }, 150);
        }

        // Debounced calculate function for input fields
        let calculateTimeout;
        function debouncedCalculate() {
            clearTimeout(calculateTimeout);
            calculateTimeout = setTimeout(() => {
                calculate();
            }, 300);
        }

        // Initialize
        initStaticSections();
        initBudgetItems();
        // Initialize income fader visuals
        setTimeout(() => updateIncomeFaderVisuals(), 0);
        // Initialize scroll animations
        setTimeout(() => initScrollAnimations(), 100);
        // Initialize countdown timer
        initCountdownTimer();
        // Initialize header banner
        initHeaderBanner();
        // Add window resize listener for charts
        window.addEventListener('resize', handleChartResize);
        // Add debounced input handlers
        document.querySelectorAll('.form-input[oninput]').forEach(input => {
            const originalOnInput = input.getAttribute('oninput');
            if (originalOnInput && originalOnInput.includes('calculate()')) {
                input.removeAttribute('oninput');
                input.addEventListener('input', debouncedCalculate);
            }
        });
        calculate();

        // Email signup handler
        function initEmailSignup() {
            const nameInput = document.getElementById('nameSignupInput');
            const emailInput = document.getElementById('emailSignupInput');
            const signupButton = document.getElementById('emailSignupButton');
            const successMessage = document.getElementById('emailSignupSuccess');

            async function handleSignup() {
                const name = nameInput.value.trim();
                const email = emailInput.value.trim();
                
                // Basic validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!name) {
                    successMessage.textContent = 'Please enter your name';
                    successMessage.style.color = 'rgba(255, 255, 255, 0.6)';
                    successMessage.classList.add('show');
                    return;
                }
                
                if (!email) {
                    successMessage.textContent = 'Please enter your email address';
                    successMessage.style.color = 'rgba(255, 255, 255, 0.6)';
                    successMessage.classList.add('show');
                    return;
                }
                
                if (!emailRegex.test(email)) {
                    successMessage.textContent = 'Please enter a valid email address';
                    successMessage.style.color = 'rgba(255, 255, 255, 0.6)';
                    successMessage.classList.add('show');
                    return;
                }

                // Disable button and show loading state
                signupButton.disabled = true;
                signupButton.textContent = 'SIGNING UP...';

                try {
                    // Send to webhook
                    const response = await fetch('/api/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: name,
                            email: email
                        })
                    });

                    if (response.ok) {
                        // Success - mark user as signed up
                        localStorage.setItem('emailSignupComplete', 'true');
                        
                        nameInput.value = '';
                        emailInput.value = '';
                        successMessage.textContent = 'Thank you! You\'ve been added to our list.';
                        successMessage.style.color = 'rgba(255, 255, 255, 0.9)';
                        successMessage.classList.add('show');
                        
                        // Enable AI analysis button
                        const aiRerunButton = document.getElementById('aiRerunButton');
                        if (aiRerunButton) {
                            aiRerunButton.classList.remove('disabled');
                        }
                        
                        // Remove signup notice from AI panel if it exists
                        const aiPanel = document.querySelector('.ai-analysis-panel');
                        if (aiPanel) {
                            const signupNotice = aiPanel.querySelector('.signup-notice');
                            if (signupNotice) {
                                signupNotice.style.animation = 'fadeOut 0.3s ease-out';
                                setTimeout(() => signupNotice.remove(), 300);
                            }
                        }
                    } else {
                        throw new Error('Signup failed');
                    }
                } catch (error) {
                    console.error('Signup error:', error);
                    successMessage.textContent = 'Something went wrong. Please try again.';
                    successMessage.style.color = 'rgba(255, 255, 255, 0.6)';
                    successMessage.classList.add('show');
                } finally {
                    // Re-enable button
                    signupButton.disabled = false;
                    signupButton.textContent = 'SIGN UP';
                }
            }

            signupButton.addEventListener('click', handleSignup);
            emailInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSignup();
                }
            });
            nameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    emailInput.focus();
                }
            });
        }

        // Initialize email signup
        initEmailSignup();

        // AI Analysis Rerun
        function initAIAnalysis() {
            const rerunButton = document.getElementById('aiRerunButton');
            
            if (!rerunButton) return;

            // Check if user has signed up on page load
            const hasSignedUp = localStorage.getItem('emailSignupComplete') === 'true';
            if (!hasSignedUp) {
                rerunButton.classList.add('disabled');
            }

            rerunButton.addEventListener('click', async function() {
                // Check if user has signed up
                const hasSignedUp = localStorage.getItem('emailSignupComplete') === 'true';
                
                if (!hasSignedUp) {
                    // Show friendly notification in AI panel
                    const aiPanel = document.querySelector('.ai-analysis-panel');
                    const existingNotice = aiPanel.querySelector('.signup-notice');
                    
                    if (existingNotice) {
                        existingNotice.remove();
                    }
                    
                    const signupNotice = document.createElement('div');
                    signupNotice.className = 'signup-notice';
                    signupNotice.innerHTML = `
                        <div class="signup-notice-icon">⚠</div>
                        <div class="signup-notice-content">
                            <div class="signup-notice-title">Email Signup Required</div>
                            <div class="signup-notice-text">Please sign up with your email at the top of the page to access AI Analysis. This helps us provide you with updates and improvements.</div>
                        </div>
                    `;
                    
                    // Insert notice at the top of the AI panel content
                    const aiHeader = aiPanel.querySelector('.ai-analysis-header');
                    if (aiHeader && aiHeader.nextSibling) {
                        aiPanel.insertBefore(signupNotice, aiHeader.nextSibling);
                    } else {
                        aiPanel.insertBefore(signupNotice, aiPanel.firstChild);
                    }
                    
                    // Scroll to email signup form
                    const emailSignupForm = document.querySelector('.header-email-signup');
                    if (emailSignupForm) {
                        emailSignupForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        // Highlight the email form briefly
                        emailSignupForm.style.transition = 'box-shadow 0.3s ease';
                        emailSignupForm.style.boxShadow = '0 0 20px rgba(255, 255, 255, 0.3)';
                        setTimeout(() => {
                            emailSignupForm.style.boxShadow = '';
                        }, 2000);
                        // Focus on name input after a brief delay
                        setTimeout(() => {
                            const nameInput = document.getElementById('nameSignupInput');
                            if (nameInput) {
                                nameInput.focus();
                            }
                        }, 800);
                    }
                    return;
                }

                // Disable button and show loading state
                rerunButton.disabled = true;
                rerunButton.classList.add('loading');

                try {
                    // Collect all financial data
                    const income = parseFloat(document.getElementById('monthlyIncome').value) || 9593.42;
                    const finalSavings = parseFloat(document.getElementById('finalSavings').textContent.replace(/[^0-9.-]/g, '')) || 0;
                    const monthlySavings = parseFloat(document.getElementById('monthlySavings').textContent.replace(/[^0-9.-]/g, '')) || 0;
                    const carEnabled = document.getElementById('carEnabled')?.checked || false;
                    const houseEnabled = document.getElementById('houseEnabled')?.checked || false;
                    const carPayment = parseFloat(document.getElementById('carPayment').textContent.replace(/[^0-9.-]/g, '')) || 0;
                    const housePayment = parseFloat(document.getElementById('housePayment').textContent.replace(/[^0-9.-]/g, '')) || 0;
                    
                    // Get car and house details
                    const carLoanMonthsEl = document.getElementById('carLoanMonths');
                    const carLoanMonths = carEnabled && carLoanMonthsEl ? parseInt(carLoanMonthsEl.value) || 60 : 0;
                    const houseAdditionalBillsEl = document.getElementById('houseAdditionalBills');
                    const houseBills = houseEnabled && houseAdditionalBillsEl ? parseFloat(houseAdditionalBillsEl.value) || 0 : 0;

                    // Prepare financial data for API (filter disabled items, include incomeEnabled)
                    const financialData = {
                        incomeEnabled: incomeEnabled !== undefined ? incomeEnabled : true,
                        income: incomeEnabled === false ? 0 : income,
                        budgetItems: budgetItems
                            .filter(item => item.enabled !== false)
                            .map(item => ({ name: item.name, amount: item.amount })),
                        finalSavings: finalSavings,
                        monthlySavings: monthlySavings,
                        carEnabled: carEnabled,
                        carPayment: carPayment,
                        carLoanMonths: carLoanMonths,
                        houseEnabled: houseEnabled,
                        housePayment: housePayment,
                        houseBills: houseBills
                    };

                    // Call AI analysis API
                    const apiUrl = '/api/ai-analysis';
                    console.log('Sending financial data to API:', financialData);

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(financialData)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('AI Analysis API error:', response.status, errorText);
                        
                        // Check if it's a 405 Method Not Allowed - likely wrong server
                        if (response.status === 405 && window.location.port !== '8888') {
                            alert('⚠️ API Error: Please use the Vercel dev server on port 8888.\n\nRun: npx vercel dev --listen 8888\nThen access: http://localhost:8888\n\nThe current server (port ' + window.location.port + ') does not support serverless functions.');
                            throw new Error('Please use Vercel dev server on port 8888');
                        }
                        
                        throw new Error(`AI analysis failed: ${response.status} ${errorText}`);
                    }

                    const result = await response.json();
                    
                    // Update UI with AI results
                    if (result.success) {
                        updateAIDisplay(result.grade, result.score, result.insights);
                    } else {
                        throw new Error(result.error || 'Unknown error');
                    }

                } catch (error) {
                    console.error('AI Analysis error:', error);
                    // Fallback to local analysis if API fails
                    runAIAnalysis();
                } finally {
                    // Re-enable button and remove loading state
                    rerunButton.disabled = false;
                    rerunButton.classList.remove('loading');
                }
            });
        }

        function updateAIDisplay(grade, score, insights) {
            // Update grade display
            document.getElementById('aiGradeLetter').textContent = grade;
            document.querySelector('.ai-grade-score').textContent = `${score}/100`;
            document.querySelector('.ai-grade-bar').style.width = `${score}%`;

            // Update insights
            const insightItems = document.querySelectorAll('.ai-insight-item');
            insightItems.forEach((item, index) => {
                if (insights && insights[index]) {
                    const insight = insights[index];
                    item.querySelector('.ai-insight-icon').textContent = insight.icon || '✓';
                    item.querySelector('.ai-insight-title').textContent = insight.title || 'Analysis';
                    item.querySelector('.ai-insight-text').textContent = insight.text || 'No insight available.';
                }
            });
        }

        function runAIAnalysis() {
            // Fallback local analysis (for demo/error cases)
            const income = parseFloat(document.getElementById('monthlyIncome').value) || 9593.42;
            const totalSpending = budgetItems.reduce((sum, item) => {
                if (item.enabled === false) return sum;
                return sum + item.amount;
            }, 0);
            const baseSavings = income - totalSpending;
            
            const spendingRatio = totalSpending / income;
            const savingsRatio = baseSavings / income;
            
            let grade = 'B+';
            let score = 78;
            
            if (spendingRatio < 0.6 && savingsRatio > 0.25) {
                grade = 'A';
                score = 92;
            } else if (spendingRatio < 0.7 && savingsRatio > 0.15) {
                grade = 'B+';
                score = 78;
            } else if (spendingRatio < 0.8 && savingsRatio > 0.1) {
                grade = 'B';
                score = 72;
            } else if (spendingRatio < 0.85) {
                grade = 'C+';
                score = 65;
            } else {
                grade = 'C';
                score = 58;
            }

            const insights = [
                {
                    icon: savingsRatio > 0.15 ? '✓' : '⚠',
                    title: 'Savings Trajectory',
                    text: savingsRatio > 0.15 
                        ? `Your savings rate of ${(savingsRatio * 100).toFixed(1)}% demonstrates strong financial discipline. Projected growth remains positive across all 5 years.`
                        : `Your savings rate of ${(savingsRatio * 100).toFixed(1)}% is below the recommended 20%. Consider increasing savings to build a stronger financial buffer.`
                },
                {
                    icon: spendingRatio < 0.75 ? '✓' : '⚠',
                    title: 'Expense Ratio',
                    text: spendingRatio < 0.75
                        ? `Your spending-to-income ratio of ${(spendingRatio * 100).toFixed(1)}% is within a healthy range. This allows for both lifestyle maintenance and savings growth.`
                        : `Your spending-to-income ratio of ${(spendingRatio * 100).toFixed(1)}% is elevated. Reducing discretionary spending by 10-15% could significantly improve your financial position.`
                },
                {
                    icon: '✓',
                    title: 'Budget Allocation',
                    text: `Your budget is well-distributed across ${budgetItems.length} categories. The largest expenses are appropriate relative to your income level.`
                },
                {
                    icon: '→',
                    title: 'Optimization Recommendation',
                    text: `Based on current projections, maintaining this lifestyle is ${score >= 70 ? 'viable' : 'challenging'}. ${score >= 70 ? 'Consider optimizing timing of major purchases to maximize savings growth.' : 'Consider reducing expenses or increasing income to improve long-term viability.'}`
                }
            ];

            updateAIDisplay(grade, score, insights);
        }

        // Initialize AI Analysis on page load
        initAIAnalysis();
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">BLACK BOX</div>
            <div class="footer-tagline">LIFESTYLE AFFORDABILITY CALCULATOR</div>
            <div class="footer-dev-tag">Made with &lt;3 by aurablox</div>
        </div>
    </footer>
</body>
</html>